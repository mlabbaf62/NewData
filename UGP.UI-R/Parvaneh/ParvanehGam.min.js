function onLoadDivMap(){CurrentStep==1&&GetScope().Functions.LoadPage(CurrentStep)}function GetScope(){return angular.element(document.getElementById("MainGam")).scope()}function StartBusy1(n){n==undefined&&(n="لطفا منتظر بمانید...");StartBusy("MainGam",n)}function StopBusy1(){StopBusy("MainGam")}function rwClick(n){GetScope().ErrorMessageCommit="";$("#rw2Div").hide();$("#rw3Div").hide();$("#btnFinalApproval").hide();n==0?($("#btnFinalApproval").show(),GetScope().GamInputData.ParvanehOk="true"):n==1?($("#rw2Div").show(),$("#divSendDatap").show(),GetScope().GamInputData.ParvanehOk="false",GetScope().RequestType2=Enumerable.From(GetScope().RequestType).Where(function(t){return t.index==n}).ToArray()):n==2&&($("#rw3Div").show(),$("#divSendDatap").show(),GetScope().GamInputData.ParvanehOk="false",GetScope().RequestType2=Enumerable.From(GetScope().RequestType).Where(function(t){return t.index==n}).ToArray(),GetScope().Functions.GetTavafoghat());GetScope().$apply();GetScope().GamInputData.rw=n;GamPlugin.SavelocalStorage(GetScope().Config.ScopeName,GetScope().GamInputData)}function openCity(n,t){for(var r,u=document.getElementsByClassName("tabcontent"),i=0;i<u.length;i++)u[i].style.display="none";for(r=document.getElementsByClassName("tablinks"),i=0;i<r.length;i++)r[i].className=r[i].className.replace(" active","");document.getElementById(t).style.display="block";n.currentTarget.className+=" active";t=="Letter2"&&GetScope().Functions.ShowArchiveLetter();t=="Sh"&&GetScope().Functions.ShowArchive()}function EnterDaftar(n){n.key=="Enter"&&GetScope().SearchDaftar()}function sortTable(n){var t;StartBusyTimer();t="";n==1&&(t="$.daf_id",s1=s1=="asc"?"desc":"asc");n==2&&(t="$.daf_name",s2=s2=="asc"?"desc":"asc");n==1&&(GetScope().EngDafaterList=s1=="asc"?Enumerable.From(GetScope().EngDafaterList).OrderBy(t).ToArray():Enumerable.From(GetScope().EngDafaterList).OrderByDescending(t).ToArray(),GetScope().$apply());n==2&&(GetScope().EngDafaterList=s2=="asc"?Enumerable.From(GetScope().EngDafaterList).OrderBy(t).ToArray():Enumerable.From(GetScope().EngDafaterList).OrderByDescending(t).ToArray(),GetScope().$apply());return}function myFunction(n){var t=Enumerable.From(GetScope().ADP).Where(function(t){return t.CI_UsingGroup==n}).Select(function(n){return n.CI_UsingType}).ToArray(),i=Enumerable.From(GetScope().CI_UsingType).Where(function(n){return Enumerable.From(t).Contains(n.Id)}).ToArray();GetScope().CI_UsingType=i;GetScope().$apply()}var app=angular.module("AppTransfer",[]),CtlTransfer=["$scope","$http",function(n){n.ArchiveProvide=typeof ArchiveProvide!="undefined"?ArchiveProvide:"";n.GreenColor=!1;n.IsValidNosaziCode=!1;n.LoadFromRequest=function(t){n.LoadFromRequestMain(t)};n.LoadObj=function(){var t,i;ClsAccount.AccountInfo!=null&&(n.p=ClsAccount.AccountInfo.NidAccount,(n.p==undefined||n.p=="")&&(n.p=getParameterByName("p")),n.ClsAccount=ClsAccount,n.Config={ScopeName:GetGamInfo()},n.GetCI_List("CI_UsingGroup"),n.GetCI_List("CI_UsingType"),n.GetCI_List("CI_DocType"),n.GetCI_List2("CI_UsingType",function(t){n.CI_UsingType=t}),n.GetCI_List2("CI_RequirmentForZabeteh",function(t){n.CI_list=t}),n.GetADP_List(),n.GamInputData.SessionId=ClsAccount.SessionId);n.Prop.ErrorMessage="";t=getParameterByName("NidProc");t!=""?(n.LoadFromRequest(t),$(GamsArray).last()[0].Name=="SaveRequest"&&(alert("گردشکار این پرونده به پایان رسیده است"),GamPlugin.ResetGamAndRedirect())):n.p!=undefined&&n.p!=""?(i=GamPlugin.GetlocalStorage(n.Config.ScopeName),i!=null&&(n.GamInputData=i,LoadNosaziCode(n.GamInputData.CurrentNosaziCode),n.GamInputData.CurrentNosaziCode!=""&&(n.GamInputData.District=n.GamInputData.CurrentNosaziCode.split("-")[0]),GamPlugin.removeStep=n.GamInputData.removeStep,n.Functions.LoadPage(n.GamInputData.CurrentStep))):alert("ابتدا باید وارد حساب کاربری خود شوید")};n.init=function(){n.DoEvents();n.StyleFunc.Load()};n.initUpload=function(){$("[id^='btnLoad']").hide();n.LetterList_OUT.forEach(function(t,i){t.IsConfirmStr=t.Sh_OfficeLetter.EumConfirm==1?"تایید":"عدم تایید";var r=Archive_NidEntityLetter,u=$("#DivLetter2"+i).AsSafaArchiveUploder();u.LoadObjSimple(n.GamInputData.ArchiveBizCode,n.GamInputData.District,{UserName:ClsAccount.AccountInfo.FullName,UserCode:ClsAccount.AccountInfo.NidAccount,FilterExtensions:typeof FileExt!="undefined"?FileExt:".png,.jpg",Multiply:!0,NidTag:r,DetectObject:!1,MinFileSize:Upload_MinFileSize,MaxFileSize:Upload_MaxFileSize,Title:"",IsRequire:!0,OtherFiled:t.Sh_OfficeLetter.NidOfficeLetter,OnCompleteUpload:function(t){n.Functions.Gam5Func_Upload.AddNidFileLetter(t.NidFile,t.OtherFiled);n.Functions.ShowArchiveLetter()}})})};n.DoEvents=function(){$(document).on("onCheckGam",{CurrentStep:0,ErrorMessage:"",AllowNextPage:!1},function(t){return n.Functions.CheckGam(t.data)});$(document).on("onLoadStep",function(t,i){i.pFromLoad?n.LoadObj():n.Functions.LoadPage(CurrentStep)})};n.ResetScope=function(){n.GamInputData={IsAccept:!1,NidBase:"",SelectedWorkFlow:{},RequestGroup:"Transfer",Address:"",EstateOwner:"",OwnerType:"مالک",Comment:"",CurrentNosaziCode:"",AllowNextPage:!1,Nahad:"",FicheRes:{PaymentMessage:null,PaymentMessageDaramad:null,CurrentNidFiche:null,CurrentNidFicheDaramad:null,isHKTruePayment:!1,TrackingCode:"",isLoaded:!1},NidWorkItem:"",NidWorkItemText:"",UploadCount:0,UploadCountRequire:0,MustUploadCount:0,IsVakil:!1,CurrentStep:1,BazdidDate:"",BazdidTime:"",ResourceId:null,Sh_RevisitAgentRandom:{Name:"",Family:"",UserName:"",Phone:""},LetterNo:"",LetterDate:"",District:null,NidNosaziCode:"",OldNidProc:"",OwnerPhone:"",ShowTransferPayment:ShowTransferPayment,ShowFicheNosazi:!0,ShowFicheDarAmad:ShowFicheDarAmad,ShowFichePasmand:ShowFichePasmand,CostKarshenasi:CostKarshenasi,CurrentJobLocation:null,AccountTell:"",MustUploadLetterCountCom:0,MustUploadLetterCountNew:0,CommentTask:"",SessionId:ClsAccount.SessionId};GetScopeMenu().Header=n.GamInputData.SelectedWorkFlow.WorkflowTitel!=undefined?n.GamInputData.SelectedWorkFlow.WorkflowTitel:"ثبت درخواست پروانه اینترنتی"};n.ResetScope();n.ClsAccount={UserInfo:{NidUser:null}};n.Functions={DownloadDWG:function(t){t==undefined&&(t=0);var i={pCode:n.GamInputData.CurrentNosaziCode,pDWGFileType:t,pDistrict:n.GamInputData.District},r=JSON.stringify(i);StartBusy1();$.ajax({type:"POST",url:ServiceAddress+"GetCadWsFileUrl",data:r,contentType:"application/json; charset=utf-8",dataType:"json",success:function(n){StopBusy1();n.CadWsFileUrl!=""?window.open(n.CadWsFileUrl,"_blank"):alert("فایلی یافت نشد")},failure:function(){StopBusy1();alert("فایلی یافت نشد")},error:function(){StopBusy1();alert("فایلی یافت نشد")}})},CheckConfirmManager:function(t){var i=GamsArray[t],r=0;if(i.IsConfirmManager!=undefined&&i.IsConfirmManager==!0){if(r=i.CI_Confirm!=undefined?i.CI_Confirm:5,AnalystConfirm(r))return!0;n.Prop.ErrorMessage=i.ConfirmManagerMessage!=undefined?i.ConfirmManagerMessage:"پرونده تایید نشده است . بعد از تایید ، پیامکی برای شما ارسال میشود ";n.GreenColor=!1;n.$apply()}else return!0},CheckConfirmManagerOnly:function(t){var i=GamsArray[t],r=0;return r=i.CI_Confirm!=undefined?i.CI_Confirm:5,AnalystConfirm(r)?!0:!1},FirstCall:!1,CheckGamPre:function(t){var i=GamsArray[GamPlugin.CurrentStep],e,u,o,r,s,f;if(n.GreenColor=!1,n.Prop.ErrorMessage="",i.Name==EumPage.Start&&(n.GamInputData.IsAccept==!0?t.AllowNextPage=!0:n.Prop.ErrorMessage="لطفا تعهدات را تایید نمایید"),i.Name==EumPage.Select?NosaziCode!=""?n.IsValidNosaziCode&&(n.GamInputData.CurrentNosaziCode=NosaziCode,n.Prop.ErrorMessageZabeteh!=""&&n.Prop.ErrorMessageZabeteh!=undefined?(n.Prop.ErrorMessage=n.Prop.ErrorMessageZabeteh,t.AllowNextPage=!1):n.GamInputData.IsAccept2!=undefined&&n.GamInputData.IsAccept2!=!0&&n.Base_PlanMosavab!=null?(n.Prop.ErrorMessage="لطفا تعهدات پروانه را انتخاب نمایید",t.AllowNextPage=!1):t.AllowNextPage=!0,$("#chIsMapOk").length>0&&(n.GamInputData.IsMapOk!=!0?(n.Prop.ErrorMessage="لطفا تعهدات جانمایی ملک را انتخاب نمایید",t.AllowNextPage=!1):t.AllowNextPage=!0)):n.Prop.ErrorMessage="لطفا کد نوسازی را وارد نمایید":i.Name==EumPage.SelectNo&&((n.GamInputData.District==null||n.GamInputData.District=="")&&(n.Prop.ErrorMessage="لطفا منطقه را مشخص نمایید",t.AllowNextPage=!1),n.GamInputData.HaveNosaziCode==!0&&n.GamInputData.CurrentNosaziCode==""?(n.Prop.ErrorMessage="لطفا کد نوسازی را مشخص نمایید",t.AllowNextPage=!1):(GetScope().GetNosaziReaseon(),t.AllowNextPage=!0)),i.Name==EumPage.WorkFlow&&($.each($("#WorkFlowDiv:visible >>> .validate"),function(n,t){$(t).val().trim()==""&&($(t).attr("placeholder","مقادیر را وارد نمایید"),GetScope().Prop.ErrorMessage="لطفا مقادیر مشخص شده را وارد نمایید",r=!1)}),r==!1?t.AllowNextPage=!1:(typeof n.WorkFlowSelect!="undefined"&&$("#DivWorkFlow input[type='radio']:checked").val()!=undefined&&(n.GamInputData.SelectedWorkFlow={NidWorkflowDeff:$("#DivWorkFlow input[type='radio']:checked").val(),WorkflowTitel:$("#DivWorkFlow input[type='radio']:checked").data("bind")}),GetScope().GamInputData.LetterDate=$("#txtLetterDateS1").val(),(GetScope().GamInputData.LetterDate==""||GetScope().GamInputData.LetterDate==undefined)&&(GetScope().GamInputData.LetterDate=$("#txtLetterDateS").val()),$("#cmbWorkFlowDeff").prop("selectedIndex")>-1&&n.GamInputData.SelectedWorkFlow!=undefined&&n.GamInputData.SelectedWorkFlow.NidWorkflowDeff!=undefined||$("#cmbWorkFlowDeff").length==0&&n.GamInputData.SelectedWorkFlow!=undefined&&n.GamInputData.SelectedWorkFlow.NidWorkflowDeff!=undefined?(e=!0,n.GamInputData.WorkFlowComments!=undefined&&n.GamInputData.WorkFlowComments!=null&&$.each(n.GamInputData.WorkFlowComments,function(n,t){t.IsChecked||(e=!1)}),e?n.GamInputData.SelectedWorkFlow.NidWorkflowDeff=="00000000-0000-0000-0000-000000000000"?n.Prop.ErrorMessage="نوع درخواست به درستی مشخص نشده است ":(t.AllowNextPage=!0,n.Functions.Gam3Func.GetGamList()):n.Prop.ErrorMessage="لطفا موارد را تایید نمایید"):(t.AllowNextPage=!1,n.Prop.ErrorMessage="لطفا درخواست مورد نظر را انتخاب نمایید"),n.GamInputData.SelectedWorkFlow.Archive_NidEntity=Archive_NidEntityParvaneh,n.GamInputData.SelectedWorkFlow.NidWorkflowDeff!=undefined&&(u=Enumerable.From(n.AllWorkflowList).Where(function(t){return t.NidWorkflowDeff.toLowerCase()==n.GamInputData.SelectedWorkFlow.NidWorkflowDeff.toLowerCase()}).FirstOrDefault(),u!=null&&u.ArchiveEntity!=undefined&&u.ArchiveEntity!=""&&(n.GamInputData.SelectedWorkFlow.Archive_NidEntity=u.ArchiveEntity)))),i.Name==EumPage.Account&&(o=$("input[required]"),t.AllowNextPage=!0,n.GamInputData.HaveSanad&&n.GamInputData.DocType==undefined&&(n.Prop.ErrorMessage="نوع سند را مشخص نمایید",t.AllowNextPage=!1),o.each(function(){$(this).val()==""&&(t.AllowNextPage=!1,$(this)[0].style.setProperty("border-color","red","important"))})),i.Name==EumPage.Avarez&&(GetScope().GamInputData.IsDoneManagerConfirm==!1?(GetScope().Prop.ErrorMessage=ConfirmManagerForAvarezMessage,t.AllowNextPage=!1):FishFunc.CheckPayFish()?t.AllowNextPage=!0:n.Prop.ErrorMessage="کاربر گرامی ، ابتدا باید عوارض  شهرداری را پرداخت نمایید"),i.Name==EumPage.AvarezDaramad&&(n.Prop.ErrorMessage="",FishFunc.CheckPayFish()?t.AllowNextPage=!0:n.Prop.ErrorMessage="کاربر گرامی ، ابتدا باید عوارض  شهرداری را پرداخت نمایید"),(i.Name==EumPage.Upload||i.Name==EumPage.UploadNewNosazi)&&(t.AllowNextPage=!0,r=!0,$.each($(":visible.validate"),function(n,i){$(i).val().trim()==""&&($(i).attr("placeholder","مقادیر را وارد نمایید"),GetScope().Prop.ErrorMessage="لطفا مقادیر مشخص شده را وارد نمایید",r=!1,t.AllowNextPage=!1)}),GetScope().GamInputData.G5r1=$('input[Name="G5r1"]:checked').val(),($(".EstelamType").length>0&&GetScope().GamInputData.G5r1==undefined||GetScope().GamInputData.G5r1=="")&&(GetScope().Prop.ErrorMessage="نوع استعلام را مشخص نمایید",r=!1,t.AllowNextPage=!1),r==!0&&(t.AllowNextPage=UploadPlugin.CheckArchiveValidity()?!0:!1)),i.Name==EumPage.SelectBazdid&&(n.GamInputData.BazdidDate==""?n.Prop.ErrorMessage="تاریخ بازدید را  وارد نمایید":n.GamInputData.Sh_RevisitAgentRandom==null?n.Prop.ErrorMessage="مامور بازدید را  انتخاب نمایید":n.GamInputData.NidProc!=undefined&&GetScope().GamInputData.ConfirmBazdid!=!0?n.Prop.ErrorMessage="تاریخ بازدید و مامور بازدید را تایید نمایید":t.AllowNextPage=!0),i.Name==EumPage.SaveRequest&&(n.GamInputData.NidWorkItem<=0?n.Prop.ErrorMessage="ابتدا باید ثبت درخواست انجام شود":t.AllowNextPage=!0),i.Name==EumPage.ShFani&&(t.AllowNextPage=!1,n.GamInputData.ShFaniOk=="true"?n.GamInputData.SendToShahrsazOk!=!0?n.Prop.ErrorMessage="باید دکمه ارسال به شهرساز را بزنید و منتظر تایید شهرساز باشید ":t.AllowNextPage=!0:n.Prop.ErrorMessage=n.GamInputData.ShFaniOk=="false"?"مدارک لازم برای دلیل عدم تایید را ارسال نمایید":"وضعیت شناسنامه فنی را مشخص نمایید "),i.Name=="ShFaniNew"&&(t.AllowNextPage=!0),i.Name==EumPage.ElamZabete&&(t.AllowNextPage=!0),i.Name==EumPage.Tavafoghat&&(n.Sh_Agreement_List!=null&&n.Sh_Agreement_List.length>0||n.GamInputData.rw==0?t.AllowNextPage=!0:n.Prop.ErrorMessage="پرونده شما در مرحله توافقات شهرسازی قرار دارد، نتایج توافقات بزودی اعلام خواهد شد"),i.Name==EumPage.ShZabete&&(t.AllowNextPage=!1,n.GamInputData.ParvanehOk=="true"?t.AllowNextPage=!0:n.Prop.ErrorMessage=n.GamInputData.ParvanehOk=="false"?"وضعیت ضابطه فنی را مشخص نمایید":"وضعیت ضابطه فنی را مشخص نمایید"),i.Name=="ShZabeteNew"&&(t.AllowNextPage=!1,n.Functions.CheckConfirmManagerOnly(GamPlugin.CurrentStep)&&(t.AllowNextPage=!0)),i.Name==EumPage.ShZabeteYazd&&(t.AllowNextPage=!0),i.Name==EumPage.Estelam&&(t.AllowNextPage=!0),i.Name==EumPage.Zavabet&&(n.ZabetehChideman==null||n.ZabetehChideman!=null&&n.ZabetehChideman.length==0?n.Prop.ErrorMessage="اعتبارسنجی  ضابطه ساختمانی انجام نشده است":n.GamInputData.rw==0&&n.GamInputData.ZabeteCommit==!0?t.AllowNextPage=!0:n.GamInputData.rw==1?n.GamInputData.FormConfirmationOK==!0?t.AllowNextPage=!0:n.Prop.ErrorMessage="اعتبارسنجی  ضابطه ساختمانی انجام نشده است":n.GamInputData.rw==2?n.GamInputData.FormConfirmationOK==!0?t.AllowNextPage=!0:n.Prop.ErrorMessage="اعتبارسنجی  ضابطه ساختمانی انجام نشده است":n.Prop.ErrorMessage="در صورت تایید نهایی میتوانید به گام بعدی بروید"),i.Name==EumPage.Engineer&&(t.AllowNextPage=!0),i.Name==EumPage.EngineerQuata&&(n.EngList==undefined?t.AllowNextPage=!0:n.EngList.length==0?n.Prop.ErrorMessage="ابتدا باید مهندسین ناظر تعریف شوند ":(s=Enumerable.From(n.LetterList_Com).Where(function(n){return n.Sh_OfficeLetter.EumConfirmOrganization==1}).Count(),s<2?n.Prop.ErrorMessage+="\r\nنقشه های سازه و تاسیسات باید مورد تایید شهرساز قرارگیرد":t.AllowNextPage=!0)),i.Name==EumPage.Commission)if(n.LetterList_Com!=null&&n.LetterList_Com.length>0){var h=Enumerable.From(n.LetterList_Com).Where(function(n){return n.LetterName=="ارائه نقشه معماري / کميسيون شهرسازي"}).ToArray(),c=Enumerable.From(h).Where(function(n){return n.Sh_OfficeLetter.EumConfirm==1}).Count(),l=Enumerable.From(n.LetterList_Com).Where(function(n){return n.Sh_OfficeLetter.CI_OfficeLetter==49}).ToArray(),a=Enumerable.From(l).Where(function(n){return n.Sh_OfficeLetter.EumConfirm==1}).Count();n.Functions.CheckConfirmManager(GamPlugin.CurrentStep)&&(t.AllowNextPage=c>=1&&a>=1?!0:!1)}else t.AllowNextPage=!0;if(i.Name==EumPage.PishFactor&&(t.AllowNextPage=!0),i.Name==EumPage.Mokatebat&&(t.AllowNextPage=!1,f=n.Functions.CheckLetters(),GamPlugin.SavelocalStorage(n.Config.ScopeName,n.GamInputData),f?t.AllowNextPage=!0:(t.AllowNextPage=!1,$("#btnSendToShahrsaz3").show())),i.Name=="MokatebatDastoor"&&(t.AllowNextPage=!1,f=n.Functions.CheckLetters(),GamPlugin.SavelocalStorage(n.Config.ScopeName,n.GamInputData),f?t.AllowNextPage=!0:(t.AllowNextPage=!1,$("#btnSendToShahrsaz3").show())),i.Name==EumPage.CheckShahrsaz&&(t.AllowNextPage=!0),i.Name==EumPage.Bime&&(t.AllowNextPage=!0),i.Name==EumPage.EngineerYazdDafater&&(n.GamInputData.SelectDaftar==undefined?n.Prop.ErrorMessage="ابتدا باید دفتر مورد نظر را انتخاب نمایید":n.GamInputData.SelectDaftar.IsConfirm==!0?t.AllowNextPage=!0:n.Prop.ErrorMessage="بعد از تایید دفاتر میتوانید به گام بعدی بروید"),i.Name==EumPage.EngineerInfo&&(n.EngInfoList!=null&&n.EngInfoList.length>0?t.AllowNextPage=!0:n.Prop.ErrorMessage="بعد از اختصاص مهندسین ناظر میتوانید به گام بعدی بروید"),i.Name==EumPage.MapControl&&(t.AllowNextPage=!0),i.Name=="POwner_EditType"){if(n.GamInputData.EditName){if(n.GamInputData.UGP_OwnerListNew[0].OwnerName=="")return n.Prop.ErrorMessage="نام مالک جدید را وارد نمایید",t;if(n.GamInputData.UGP_OwnerListNew[0].OwnerLastName=="")return n.Prop.ErrorMessage="نام خانوادگی مالک جدید را وارد نمایید",t;if(n.GamInputData.UGP_OwnerListNew[0].OwnerNationalCode=="")return n.Prop.ErrorMessage="کد ملی مالک جدید را وارد نمایید",t;if(n.GamInputData.UGP_OwnerListNew[0].OwnerMobile=="")return n.Prop.ErrorMessage="شماره همراه مالک جدید را وارد نمایید",t;if(n.GamInputData.UGP_Owner_Comment==undefined||n.GamInputData.UGP_Owner_Comment=="")return n.Prop.ErrorMessage="توضیحات مالکین را وارد نمایید",t}if(n.GamInputData.EditFich&&n.GamInputData.POwner_Upload!=!0)return n.Prop.ErrorMessage="اطلاعات فیش را بارگذاری نمایید",t;if(n.GamInputData.EditFich||n.GamInputData.EditName)t.AllowNextPage=!0;else return n.Prop.ErrorMessage="لطفا یک مورد را انتخاب نمایید",t}return i.Name=="EditAccount"&&(n.ClsAccount.AccountInfo.OwnerTell==""||n.ClsAccount.AccountInfo.OwnerTell==undefined?n.Prop.ErrorMessage="تلفن همراه را وارد نمایید":n.GamInputData.Comment==""||n.GamInputData.Comment==undefined?n.Prop.ErrorMessage="توضیحات را وارد نمایید":t.AllowNextPage=!0),i.Name==EumPage.PPayKarshenasi&&(GetScope().GamInputData.FicheRes.isHKTruePayment!=!0?(GetScope().Prop.ErrorMessage="ابتدا باید هزینه کارشناسی را پرداخت نمایید",r=!1):t.AllowNextPage=!0),i.Name==""&&(t.AllowNextPage=!0),t},CheckGam:function(t){t.AllowNextPage=DebugMode;var i=GamsArray[GamPlugin.CurrentStep],r=0;return i.IsConfirmManager!=undefined&&i.IsConfirmManager==!0&&(r=i.CI_Confirm!=undefined?i.CI_Confirm:5),CheckIsDoneManagerConfirmAll(r=>{r==!0?i.Goto!=undefined&&resCi2==!0?(t.AllowNextPage=!0,GamPlugin.CurrentStep=i.Goto-1):t=n.Functions.CheckGamPre(t):n.Prop.ErrorMessage=i.ConfirmManagerMessage!=undefined?i.ConfirmManagerMessage:"بعد از تایید مدیران میتوانید به گام بعدی بروید",n.GreenColor=!1,n.$apply()},"GridView1",r,i.CI_Confirm2,i.Goto),t.AllowNextPage==!0?(n.GamInputData.CurrentStep=GamPlugin.CurrentStep+1,GamPlugin.SavelocalStorage(n.Config.ScopeName,n.GamInputData)):(n.Prop.ErrorMessage==""&&(n.Prop.ErrorMessage="لطفا اطلاعات مربوط به این مرحله را کامل نمایید"),t.ErrorMessage=n.Prop.ErrorMessage),n.$apply(),t},LoadPage:function(){function r(t){n.GamInputData.Wkt=t;alert("محدوده انتخاب شد")}var t=GamsArray[GamPlugin.CurrentStep],i;t.btnPreHide!=undefined&&t.btnPreHide==!0&&$("#btnPre").hide();ClsMenu.Archive_NidEntity!=undefined&&(n.GamInputData.SelectedWorkFlow.Archive_NidEntity=ClsMenu.Archive_NidEntity);t.Archive_NidEntity!=undefined&&(n.GamInputData.SelectedWorkFlow.Archive_NidEntity=t.Archive_NidEntity);t.ReportName!=undefined&&(n.GamInputData.ReportName=t.ReportName);t.Name!="ShFaniNew"&&(n.Functions.CheckConfirmManager(GamPlugin.CurrentStep-1)||($("#Step"+GamPlugin.CurrentStep).detach(),n.$apply()));t.Name=="ShFaniNew"&&n.Functions.CheckConfirmManagerOnly(GamPlugin.CurrentStep)&&($("#ShFaniNotOk").detach(),n.$apply());t.Name=="ShZabeteNew"&&(n.Functions.CheckConfirmManagerOnly(GamPlugin.CurrentStep)&&($("#ShZabeteNotOk").detach(),n.$apply()),n.GetOwnerZabetehComment());n.Prop.CurrentPageName=t.Title;n.GamInputData.SelectedWorkFlow!=undefined&&n.GamInputData.SelectedWorkFlow.WorkflowTitel!=""&&n.GamInputData.SelectedWorkFlow.WorkflowTitel!=undefined&&(n.Prop.CurrentPageName=n.Prop.CurrentPageName.replace("پروانه",n.GamInputData.SelectedWorkFlow.WorkflowTitel));t.Name==EumPage.WorkFlow&&(n.Functions.Gam3Func.GetWorkFlowList(),n.Functions.Gam3Func.GetAllWorkFlowList(),n.Quize.GetWorkFlowQuestion(),n.GamInputData.SelectedWorkFlow={},n.Functions.GetNahadList());(t.Name==EumPage.Select||t.Name==EumPage.SelectNo)&&(LoadMap(),LoadNosaziCode(n.GamInputData.CurrentNosaziCode),ClsMenu!=undefined&&(ClsMenu.NidWorkflowDeff!=undefined&&(n.GamInputData.SelectedWorkFlow.NidWorkflowDeff=ClsMenu.NidWorkflowDeff),ClsMenu.Caption!=undefined&&(n.GamInputData.SelectedWorkFlow.WorkflowTitel=ClsMenu.Caption),ClsMenu.Archive_NidEntity!=undefined&&(n.GamInputData.SelectedWorkFlow.Archive_NidEntity=ClsMenu.Archive_NidEntity)),n.GamInputData.MenuID=getParameterByName("ID"));t.Name==EumPage.SelectNo&&(LoadMap(),ClsMenu!=undefined&&(ClsMenu.NidWorkflowDeff!=undefined&&(n.GamInputData.SelectedWorkFlow.NidWorkflowDeff=ClsMenu.NidWorkflowDeff),ClsMenu.Caption!=undefined&&(n.GamInputData.SelectedWorkFlow.WorkflowTitel=ClsMenu.Caption),ClsMenu.Archive_NidEntity!=undefined&&(n.GamInputData.SelectedWorkFlow.Archive_NidEntity=ClsMenu.Archive_NidEntity)),MyMap.SetDarwingCallBack(r));t.Name==EumPage.Upload&&(n.GamInputData.SelectedWorkFlow.NidWorkflowDeff==undefined&&(n.GamInputData.SelectedWorkFlow={NidWorkflowDeff:NidWorkFlowDeff_Parvaneh,WorkflowTitel:"ثبت درخواست پروانه ساختمانی"}),UploadPlugin.LoadObj(n.GamInputData.SelectedWorkFlow.Archive_NidEntity),n.Functions.Gam3Func.SelectUserOfWorkFlow());t.Name==EumPage.UploadNewNosazi&&(n.GamInputData.SelectedWorkFlow.NidWorkflowDeff==undefined&&(n.GamInputData.SelectedWorkFlow={NidWorkflowDeff:NidWorkFlowDeff_Parvaneh,WorkflowTitel:"ثبت درخواست پروانه ساختمانی"}),LoadLastUploadedFile=!1,n.GamInputData.HaveNosaziCode?UploadPlugin.LoadObj(n.GamInputData.SelectedWorkFlow.Archive_NidEntity):UploadPlugin.LoadObjNewNosazi(n.GamInputData.SelectedWorkFlow.Archive_NidEntity),n.Functions.Gam3Func.SelectUserOfWorkFlow());t.Name==EumPage.SelectBazdid&&(n.GamInputData.ShowRevisitAgentName=typeof ShowRevisitAgentName=="undefined"?!0:ShowRevisitAgentName,n.GamInputData.ShowRevisitAgentTell=typeof ShowRevisitAgentTell=="undefined"?!0:ShowRevisitAgentTell,DateBazdidPlugin.LoadCalender());t.Name==EumPage.Avarez&&(n.GamInputData.CalculateDarAmad=ClaculateDarAmad,t.CalculateDarAmad!=undefined&&(n.GamInputData.CalculateDarAmad=t.CalculateDarAmad),n.GamInputData.AlwaysCalculate=t.AlwaysCalculate==!0?!0:!1,n.GamInputData.ShowFicheNosazi=!0,FishFunc.LoadFich());t.Name==EumPage.SaveRequest&&(n.GamInputData.NidWorkItem>0&&$("#btnPre").hide(),n.GamInputData.SelectedWorkFlow.AssignUser==undefined&&n.Functions.Gam3Func.SelectWorkFlowForAssignUser());t.Name==EumPage.ElamZabete&&(FishFunc.CheckPayFish()?$("#divExport").show():(n.Prop.ErrorMessage="عوارض به طور کامل پرداخت نشده است .",$("#divExport").detach(),$("#btnPre").show()),n.GamInputData.IsExport==!0&&($("#btnExport").hide(),i=n.GamInputData.NidProc,n.Functions.LoadInqueryArchive(i)));t.Name==EumPage.Export&&(FishFunc.CheckPayFish()?$("#divExport").show():(n.Prop.ErrorMessage="عوارض به طور کامل پرداخت نشده است .",$("#divExport").detach(),$("#btnPre").show()),n.GamInputData.IsExport==!0&&($("#btnExport").hide(),i=n.GamInputData.NidProc,n.Functions.LoadInqueryArchive(i)));t.Name==EumPage.ShFani&&($("#divShFani").show(),n.GetOwnerZabetehComment(),n.Functions.Gam5Func_Upload.LoadArchiveForSendDoc(GetScope().GamInputData.ArchiveBizCode,"#divUploaderSend","ارسال مدارک به شهرساز"),$("#btnNext").prop("disabled",!1),n.Functions.ShowArchive());(t.Name==EumPage.ShZabete||t.Name==EumPage.ShZabeteYazd)&&($(".tablinks")[0]!=undefined&&($(".tablinks")[0].className+=" active"),n.Functions.LoadZabeteh(),rwClick(n.GamInputData.rw),t.Name==EumPage.ShZabeteYazd);t.Name==EumPage.AvarezDaramad&&(n.GamInputData.ShowFicheDarAmad=!1,n.GamInputData.ShowFichePasmand=!1,n.GamInputData.ShowFicheNosazi=!1,n.GamInputData.ShowFicheAvarezDarAmad=!0,n.GamInputData.CalculateDarAmad=!1,ClaculateDarAmad=!1,GamPlugin.SavelocalStorage(n.Config.ScopeName,n.GamInputData),FishFunc.LoadFich());t.Name==EumPage.Estelam&&SendSMSGam(6);t.Name==EumPage.Zavabet&&(n.Functions.EstelamzabeteCrowd(),n.GetOwnerZabetehComment());t.Name==EumPage.Tavafoghat&&(n.GamInputData.rw!=2?typeof isPreStep!="undefined"&&isPreStep==!0?GamPlugin.preStep():GamPlugin.nextStepWithOutCheck():(n.Prop.ErrorMessage="پرونده شما در مرحله توافقات شهرسازی قرار دارد، نتایج توافقات بزودی اعلام خواهد شد",n.Functions.GetTavafoghat()));t.Name==EumPage.Engineer&&n.EngFunc.GetEnginner();t.Name==EumPage.EngineerInfo&&n.EngFunc.GetEngInfo();t.Name==EumPage.EngineerQuata&&n.EngFunc.GetEnginnerQuata();t.Name==EumPage.EngineerYazdDafater&&(n.EngFunc.GetEngineerYazdDafater(),n.EngFunc.GetOffice());t.Name==EumPage.Taahodat&&(n.Functions.GamTahodatFunc.GetCommitmentCitizen(),n.Functions.GamTahodatFunc.GetUGPFormName());t.Name==EumPage.Commission&&(n.LoadLetter(),$("#btnPre").hide(),openCity(event,"DivCommission"),$("#t1").addClass("active"));t.Name==EumPage.Mokatebat&&(t.IsNew!=undefined&&t.IsNew==!0&&(n.GamInputData.IsNew=!0),n.LoadLetter());t.Name=="MokatebatDastoor"&&(t.IsNew!=undefined&&t.IsNew==!0&&(n.GamInputData.IsNew=!0),n.LoadLetter());t.Name==EumPage.MapControl&&n.Functions.LoadMapControl();t.Name==EumPage.GetNewNosaziCode&&n.Functions.GetNewNosaziCode();t.Name=="POwner_EditType"&&($UploaderCount=0,$("#divUploaderEditOwner").children().length==0&&UploadPlugin.GetBizCodeCallback(function(i){UploadPlugin.NidTag=t.NidTag;var r=$("#divUploaderEditOwner").AsSafaArchiveUploder();r.LoadObj(i,UploadPlugin.Domain,{UserName:ClsAccount.AccountInfo.FullName,UserCode:ClsAccount.AccountInfo.NidAccount,Multiply:!0,NidTag:UploadPlugin.NidTag,SaveOrginalFile:typeof SaveOrginalFile!="undefined"?SaveOrginalFile:!0,DetectObject:!1,MinFileSize:Upload_MinFileSize,MaxFileSize:Upload_MaxFileSize,Title:"اطلاعات فیش نوسازی",IsRequire:!0,FilterExtensions:typeof FileExt!="undefined"?FileExt:".png,.jpg",OnCompleteUpload:function(t){UploadPlugin.AddNidFile(t.NidFile,!0,"",t.OtherFiled);n.GamInputData.POwner_Upload=!0}})}),$UploaderCount=1,n.GamInputData.UGP_OwnerListOld==undefined&&(n.GamInputData.UGP_OwnerListOld=[],n.GamInputData.UGP_OwnerListOld.push({OwnerName:"",OwnerLastName:"",OwnerNationalCode:"",OwnerMobile:"",OwnerAddress:""})),n.GamInputData.UGP_OwnerListNew==undefined&&(n.GamInputData.UGP_OwnerListNew=[],n.GamInputData.UGP_OwnerListNew.push({OwnerName:"",OwnerLastName:"",OwnerNationalCode:"",OwnerMobile:"",OwnerAddress:"",OwnerPostCode:""})));t.Name==EumPage.PPayKarshenasi&&FishFunc.LoadFichKarshenasi();n.$apply()},AddOwnerOld:function(){n.GamInputData.UGP_OwnerListOld.push({OwnerName:"",OwnerLastName:"",OwnerNationalCode:"",OwnerMobile:"",OwnerAddress:""})},RemoveOwnerOld:function(t){dictionary=Enumerable.From(n.GamInputData.UGP_OwnerListOld).ToDictionary();dictionary.Remove(t);n.GamInputData.UGP_OwnerListOld=dictionary.ToEnumerable().Select(n=>n.Key).ToArray()},AddOwnerNew:function(){n.GamInputData.UGP_OwnerListNew.push({OwnerName:"",OwnerLastName:"",OwnerNationalCode:"",OwnerMobile:"",OwnerAddress:"",OwnerPostCode:""})},RemoveOwnerNew:function(t){dictionary=Enumerable.From(n.GamInputData.UGP_OwnerListNew).ToDictionary();dictionary.Remove(t);n.GamInputData.UGP_OwnerListNew=dictionary.ToEnumerable().Select(n=>n.Key).ToArray()},onNosaziCodeClick:function(){n.Functions.Gam2Func.CheckRequestValidity()},Gam2Func:{inProgress:!1,CheckRequestValidity:function(){var t;if(!this.inProgress){this.inProgress=!0;n.IsValidNosaziCode=!1;n.Prop.ErrorMessage="";t=n.GamInputData.SelectedWorkFlow.NidWorkflowDeff;t==undefined&&(t=NidWorkFlowDeff_Parvaneh);StartBusy1("در حال استعلام کد نوسازی");var i={pCode:NosaziCode,pNidWorkItem:"",pNidWorkflowDeffNew:t,pNidAccount:ClsAccount.AccountInfo.NidAccount,pNationalCode:ClsAccount.AccountInfo.OwnerNationalCode,pelakType:n.GamInputData.SelectType},r=JSON.stringify(i),u='کد نوسازی معتبر نمیباشد،خواهشمند است با در دست داشتن مدارک به شهرداری منطقه مراجعه فرمایید"';$request=$.ajax({type:"POST",url:ServiceAddress+"CheckRequestValidity",data:r,crossDomin:!0,contentType:"application/json; charset=utf-8",dataType:"json",processdata:!0,success:function(t){try{StopBusy1();n.Functions.Gam2Func.inProgress=!1;var r=!1,i="";n.GamInputData.NidNosaziCode=t.RequestValidity.Sh_RequestInfo.NidNosaziCode;t.Base_Owner!=null&&t.Base_Owner.length>0&&(n.GamInputData.Base_Owner=t.Base_Owner[0],n.GamInputData.Base_Owner.Base_RegisterPlack=t.Base_RegisterPlack,t.Base_Owner.length>1&&t.Base_Owner[0].ToftDang!=6&&(n.GamInputData.Owner2=!0));n.GamInputData.ShowReport=t.RequestValidity.ShowReport;t.ErrorResult.BizErrors.length>0?($.each(t.ErrorResult.BizErrors,function(n,t){t.ErrorAction>-1&&t.ErrorKey!=1e3&&t.ErrorTitel!=""&&(i+=t.ErrorTitel+"\r\n");t.ErrorAction==0&&(r=!0)}),r==!0?(n.Prop.ErrorMessage=i,n.IsValidNosaziCode=!1):n.Prop.ErrorMessage=i):CheckBaygani==!1||t.RequestValidity.Sh_RequestInfo.EumRequestStatus==2?(n.GamInputData.NidBase=t.RequestValidity.NidBase,n.GamInputData.District=District1,n.GamInputData.Address=t.RequestValidity.Sh_RequestInfo.RequesterAddress,n.GamInputData.EstateOwner=t.RequestValidity.Sh_RequestInfo.RequesterName,n.GamInputData.NidNosaziCode=t.RequestValidity.Sh_RequestInfo.NidNosaziCode,n.GamInputData.OldNidProc=t.RequestValidity.Sh_RequestInfo.NidProc,n.GamInputData.CurrentNosaziCode=NosaziCode,n.GamInputData.FloorDone=t.Base_CommonEstate.FloorDone,n.GreenColor=!0,n.Prop.ErrorMessage="کد نوسازی معتبر می باشد , برای ادامه روند کار بر روی گام بعدی کلیک نمایید",n.IsValidNosaziCode=!0,n.$apply(),n.Functions.Estelamzabete(!0)):(n.GreenColor=!1,n.Prop.ErrorMessage="پرونده شما در شهرسازی باید به مرحله تایید و بایگانی رسیده باشد");n.$apply()}catch(u){n.Prop.ErrorMessage="خطایی در اطلاعات وجود دارد . لطفا با راهبر سیستم هماهنگ نمایید";n.$apply()}},error:function(){n.Functions.Gam2Func.inProgress=!1;n.Prop.ErrorMessage=u;n.GreenColor=!1;StopBusy1();GetScope().$apply()}})}},FillEngineerInfo:function(){var t={pNidNosazicode:n.GamInputData.NidNosaziCode,pNidProc:n.GamInputData.NidProc,pDomain:n.GamInputData.District},i=JSON.stringify(t);$request=$.ajax({type:"POST",url:ServiceAddress+"FillEngineerInfo",data:i,crossDomin:!0,contentType:"application/json; charset=utf-8",dataType:"json",processdata:!0,success:function(t){t.FillEngineerInfo!=null&&(t.FillEngineerInfo.foundation!=null&&(n.GamInputData.foundation=t.FillEngineerInfo.foundation),t.FillEngineerInfo.BuildingType!=null&&(n.GamInputData.BuildingType=t.FillEngineerInfo.BuildingType),t.FillEngineerInfo.FloorDone!=null&&(n.GamInputData.FloorDone=t.FillEngineerInfo.FloorDone))},error:function(){}})},FillEngineerInfo2:function(){var t={pDistrict:n.GamInputData.District,pNidProc:n.GamInputData.NidProc},i=JSON.stringify(t);$.ajax({type:"POST",url:ServiceAddress+"GetMapControl",data:i,crossDomin:!0,contentType:"application/json; charset=utf-8",dataType:"json",processdata:!0,success:function(){n.Functions.Gam2Func.FillEngineerInfo()},error:function(){StopBusy("GridViewTarakom")}})}},Gam3Func:{GetGamList:function(){var t=Enumerable.From(GetScopeMenu().Menu[1].SubMenu).Where(function(t){return t.NidWorkflowDeff!=undefined&&t.NidWorkflowDeff.toLowerCase()==n.GamInputData.SelectedWorkFlow.NidWorkflowDeff.toLowerCase()}).FirstOrDefault();if(t!=undefined&&typeof WorkflowReadonly!="undefined"&&WorkflowReadonly!=!0){var e=getQueryVariable(window.location.search,"ID"),i={ID:t.ID},r=window.location.href.replace(window.location.search,""),u=r+"?"+jQuery.param(i),f=n.Config.ScopeName.replace("-ID"+getParameterByName("ID"),"-ID"+t.ID);GamPlugin.CurrentStep++;n.GamInputData.CurrentStep=GamPlugin.CurrentStep;GamPlugin.SavelocalStorage(f,n.GamInputData);window.history.pushState("object or string","Title",u);GamPlugin.RemovelocalStorage(n.Config.ScopeName);location.reload()}},GetWorkFlowList:function(){n.Prop.ErrorMessage=null;$.ajax({type:"POST",url:"FrmParvaneh.aspx/GetWorkFlowList",crossDomin:!0,contentType:"application/json; charset=utf-8",dataType:"json",processdata:!0,success:function(t){if(n.Functions.CheckError(t)){n.Prop.WorkflowList=t.d.WorkflowList;var i=getParameterByName("NidWorkFlow");i!=null&&i!=""&&($("#cmbWorkFlowDeff").prop("disabled","disabled"),n.GamInputData.SelectedWorkFlow=n.Prop.WorkflowList[i]);n.$apply()}},error:function(){}})},GetAllWorkFlowList:function(){$.ajax({type:"POST",url:"FrmParvaneh.aspx/GetAllWorkFlowList",crossDomin:!0,contentType:"application/json; charset=utf-8",dataType:"json",processdata:!0,success:function(t){n.AllWorkflowList=t.d.WorkflowList;n.$apply()},error:function(){}})},SelectUserOfWorkFlow:function(){var i,r,u,t,f;try{i="";r="";n.GamInputData.SelectedWorkFlow.AssignUser!=undefined&&n.GamInputData.SelectedWorkFlow.AssignUser!=""&&(u=n.GamInputData.SelectedWorkFlow.AssignUser.split(","),t=Enumerable.From(u).Where(function(t){return t.split(":")[0]==n.GamInputData.District}).FirstOrDefault(),t!=null&&t!=undefined&&(i=t.split(":")[1]),r="",f=Enumerable.From(GamsArray).Where(function(n){return n.Name==EumPage.JobLocation}).Select(function(n){return n.Index}).FirstOrDefault(),GamPlugin.removeStep=f-1,n.GamInputData.removeStep=GamPlugin.removeStep);n.GamInputData.ProcInitiator=i;n.GamInputData.ProcInitiatorUserName=r;n.GamInputData.SelectedWorkFlow.ArchiveEntity!=undefined&&(Archive_NidEntityParvaneh=n.GamInputData.SelectedWorkFlow.ArchiveEntity)}catch(e){}},SelectWorkFlowForAssignUser:function(){n.Prop.ErrorMessage=null;StartBusy1();$.ajax({type:"POST",url:"FrmParvaneh.aspx/GetAllWorkFlowList",crossDomin:!0,contentType:"application/json; charset=utf-8",dataType:"json",processdata:!0,success:function(t){var u,i,f,r;if(StopBusy1(),n.Functions.CheckError(t)){n.Prop.AllWorkflowList=t.d.WorkflowList;u=n.GamInputData.SelectedWorkFlow.NidWorkflowDeff;try{i=Enumerable.From(n.Prop.AllWorkflowList).Where(function(n){return n.NidWorkflowDeff.toLowerCase()==u.toLowerCase()}).FirstOrDefault()}catch(e){}i!=null&&i.AssignUser!=null&&(n.GamInputData.SelectedWorkFlow.AssignUser=i.AssignUser,f=n.GamInputData.SelectedWorkFlow.AssignUser.split(","),r=Enumerable.From(f).Where(function(t){return t.split(":")[0]==n.GamInputData.District}).FirstOrDefault(),r!=null&&r!=undefined&&(tmpProcInitiator=r.split(":")[1],n.GamInputData.ProcInitiator=tmpProcInitiator));n.$apply()}},error:function(){}})}},Gam5Func_Upload:{AddNidFileLetter:function(t,i,r=false){r!=!0&&n.GamInputData.MustUploadLetterCount++;n.$apply();GamPlugin.SavelocalStorage(n.Config.ScopeName,n.GamInputData);var u={pNidNidOfficeLetter:i,pArchiveNidFile:t,pDistrict:n.GamInputData.District},f=JSON.stringify(u);$request=$.ajax({type:"POST",url:ServiceAddress+"UpdateUploadTime",data:f,crossDomin:!0,contentType:"application/json; charset=utf-8",dataType:"json",processdata:!0,success:function(){},error:function(){}})},AddNidFileLetterCom:function(t,i){n.GamInputData.MustUploadLetterCountCom++;$("#btnSendToShahrsazCom").show();n.$apply();GamPlugin.SavelocalStorage(n.Config.ScopeName,n.GamInputData);var r={pNidNidOfficeLetter:i,pArchiveNidFile:t,pDistrict:n.GamInputData.District},u=JSON.stringify(r);$request=$.ajax({type:"POST",url:ServiceAddress+"UpdateUploadTime",data:u,crossDomin:!0,contentType:"application/json; charset=utf-8",dataType:"json",processdata:!0,success:function(){},error:function(){}})},AddNidFileLetterNew:function(t,i,r){var u,f;n.GamInputData.MustUploadLetterCountNew++;n.$apply();GamPlugin.SavelocalStorage(n.Config.ScopeName,n.GamInputData);u={pNidNidOfficeLetter:i,pArchiveNidFile:t,pDistrict:n.GamInputData.District};f=JSON.stringify(u);$request=$.ajax({type:"POST",url:ServiceAddress+"UpdateUploadTime",data:f,crossDomin:!0,contentType:"application/json; charset=utf-8",dataType:"json",processdata:!0,success:function(){},error:function(){}});u={pDistrict:n.GamInputData.District,pNidWorkItem:n.GamInputData.NidWorkItem,pBizCodeArchive:n.GamInputData.ArchiveBizCode,pArchive_NidEntity:r};f=JSON.stringify(u);$request=$.ajax({type:"POST",url:"UTransferGam.aspx/ChangeArchiveFolder",data:f,crossDomin:!0,contentType:"application/json; charset=utf-8",dataType:"json",processdata:!0,success:function(){},error:function(){}})},LoadArchiveForSendDoc:function(t,i,r){$(i).empty();var u=Archive_NidEntitySend,f=n.GamInputData.District,e=$(i).AsSafaArchiveUploder();e.LoadObj(t,f,{UserName:ClsAccount.AccountInfo.FullName,UserCode:ClsAccount.AccountInfo.NidAccount,FilterExtensions:typeof FileExt!="undefined"?FileExt:".png,.jpg",Multiply:!0,NidTag:u,DetectObject:!1,MinFileSize:Upload_MinFileSize,MaxFileSize:Upload_MaxFileSize,Title:r,IsRequire:!0,OnCompleteUpload:function(t){n.Functions.ShowArchive();n.GamInputData.UploadShFaniOk=!0;GamPlugin.SavelocalStorage(n.Config.ScopeName,n.GamInputData);n.Functions.Gam5Func_Upload.AddNidFile(t.NidFile,t.IsRequire)}})}},Gam7Func:{SaveRequest:function(){var r=GamsArray[GamPlugin.CurrentStep],u,t,f,i,e;if(!(typeof ClsSMS=="undefined")&&ClsSMS.ConfirmCodeOk!=!0&&n.GamInputData.ConfirmCodeOk!=!0&&(typeof DontCheckSMS=="undefined"||typeof DontCheckSMS!="undefined"&&DontCheckSMS==!1)){n.Prop.ErrorMessage="کد تاییدیه صحیح نمی باشد";return}if(n.Prop.ErrorMessage="",u=GetCurrentEnDate(),n.GamInputData.BazdidDate!=""&&(t=n.GamInputData.BazdidDate.split("/"),f=ToGregorian(parseInt(t[0]),parseInt(t[1]),parseInt(t[2])),f<u)){n.Prop.ErrorMessage="تاریخ مامور بازدید گذشته است . دوباره انتخاب نمایید";return}(n.GamInputData.SelectedWorkFlow.AssignUser==undefined||n.GamInputData.SelectedWorkFlow.AssignUser==""||n.GamInputData.ProcInitiator==undefined||n.GamInputData.ProcInitiator=="")&&n.GamInputData.Sh_RevisitAgentRandom!=null&&n.GamInputData.Sh_RevisitAgentRandom.NidRevisitAgent!=undefined&&(n.GamInputData.ProcInitiator=n.GamInputData.Sh_RevisitAgentRandom.NidUser,n.GamInputData.ProcInitiatorUserName=n.GamInputData.Sh_RevisitAgentRandom.Name+" "+n.GamInputData.Sh_RevisitAgentRandom.LastName);(n.GamInputData.ProcInitiator==undefined||n.GamInputData.ProcInitiator=="")&&(n.GamInputData.ProcInitiator="00000000-0000-0000-0000-000000000000");r.DontAddRevisitAgent!=undefined&&(n.GamInputData.DontAddRevisitAgent=r.DontAddRevisitAgent);(GetScope().GamInputData.LetterDate==""||GetScope().GamInputData.LetterDate==undefined)&&(GetScope().GamInputData.LetterDate=$("#txtLetterDate").val());(GetScope().GamInputData.LetterDate==""||GetScope().GamInputData.LetterDate==undefined)&&(GetScope().GamInputData.LetterDate=$("#txtLetterDateS").val());(GetScope().GamInputData.LetterDate==""||GetScope().GamInputData.LetterDate==undefined)&&(GetScope().GamInputData.LetterDate=$("#txtLetterDateS1").val());(GetScope().GamInputData.MandateDate==""||GetScope().GamInputData.MandateDate==undefined)&&(GetScope().GamInputData.MandateDate=$("#txtLetterDateV").val());n.GamInputData.NidAccount=ClsAccount.AccountInfo.NidAccount;(typeof AddCommentTask=="undefined"||AddCommentTask!=!1&&n.GamInputData.SelectedWorkFlow.WorkflowTitel!=undefined&&n.GamInputData.SelectedWorkFlow.WorkflowTitel!="")&&(n.GamInputData.CommentTask=n.GamInputData.SelectedWorkFlow.WorkflowTitel);n.GamInputData.HaveBuilding&&(n.GamInputData.CommentTask+="\r\nملک دارای ساختمان است");n.GamInputData.DocType!=undefined&&(n.GamInputData.CommentTask+="\r\nنوع سند:"+n.GamInputData.DocType);n.GamInputData.HaveSanad&&(n.GamInputData.CommentTask+="\r\nپلاک ثبتی:"+n.GamInputData.RegisterPelakAsli+"/"+n.GamInputData.RegisterPelakFaree+"/"+n.GamInputData.RegisterPelakBakhsh);n.GamInputData.SelectedWorkFlow.WorkflowTitel!=undefined&&(n.GamInputData.Comment+="\r\n"+n.GamInputData.SelectedWorkFlow.WorkflowTitel);n.GamInputData.FullLable!=undefined&&n.GamInputData.FullLable!=""&&(n.GamInputData.CommentTask+="\r\n"+n.GamInputData.FullLable);n.GamInputData.EditName==!0&&(n.GamInputData.UGP_OwnerListOld.length>0&&(n.GamInputData.Comment+="\r\n نام مالک قدیم :  ",n.GamInputData.Comment+=n.GamInputData.UGP_OwnerListOld[0].OwnerName,n.GamInputData.Comment+=" "+n.GamInputData.UGP_OwnerListOld[0].OwnerLastName,n.GamInputData.Comment+="  |   کد ملی :  ",n.GamInputData.Comment+=" "+n.GamInputData.UGP_OwnerListOld[0].OwnerNationalCode,n.GamInputData.Comment+="  |   شماره همراه :  ",n.GamInputData.Comment+=" "+n.GamInputData.UGP_OwnerListOld[0].OwnerMobile,n.GamInputData.Comment+="  |   کد پستی :  ",n.GamInputData.Comment+=" "+n.GamInputData.UGP_OwnerListOld[0].OwnerPostCode,n.GamInputData.Comment+="  |   آدرس :  ",n.GamInputData.Comment+=" "+n.GamInputData.UGP_OwnerListOld[0].OwnerAddress),n.GamInputData.UGP_OwnerListOld.length>1&&(n.GamInputData.Comment+="\r\n نام مالک قدیم :  ",n.GamInputData.Comment+=n.GamInputData.UGP_OwnerListOld[1].OwnerName,n.GamInputData.Comment+=" "+n.GamInputData.UGP_OwnerListOld[1].OwnerLastName,n.GamInputData.Comment+="  |   کد ملی :  ",n.GamInputData.Comment+=" "+n.GamInputData.UGP_OwnerListOld[1].OwnerNationalCode,n.GamInputData.Comment+="  |   شماره همراه :  ",n.GamInputData.Comment+=" "+n.GamInputData.UGP_OwnerListOld[1].OwnerMobile,n.GamInputData.Comment+="  |   کد پستی :  ",n.GamInputData.Comment+=" "+n.GamInputData.UGP_OwnerListOld[1].OwnerPostCode,n.GamInputData.Comment+="  |   آدرس :  ",n.GamInputData.Comment+=" "+n.GamInputData.UGP_OwnerListOld[1].OwnerAddress),n.GamInputData.Comment+="\r\n-------------------------------------------------------------\r\n",n.GamInputData.UGP_OwnerListNew.length>0&&(n.GamInputData.Comment+="\r\n نام مالک جدید :  ",n.GamInputData.Comment+=n.GamInputData.UGP_OwnerListNew[0].OwnerName,n.GamInputData.Comment+=" "+n.GamInputData.UGP_OwnerListNew[0].OwnerLastName,n.GamInputData.Comment+="  |   کد ملی :  ",n.GamInputData.Comment+=" "+n.GamInputData.UGP_OwnerListNew[0].OwnerNationalCode,n.GamInputData.Comment+="  |   شماره همراه :  ",n.GamInputData.Comment+=" "+n.GamInputData.UGP_OwnerListNew[0].OwnerMobile,n.GamInputData.Comment+="  |   کد پستی :  ",n.GamInputData.Comment+=" "+n.GamInputData.UGP_OwnerListNew[0].OwnerPostCode,n.GamInputData.Comment+="  |   آدرس :  ",n.GamInputData.Comment+=" "+n.GamInputData.UGP_OwnerListNew[0].OwnerAddress),n.GamInputData.UGP_OwnerListNew.length>1&&(n.GamInputData.Comment+="\r\n نام مالک جدید :  ",n.GamInputData.Comment+=n.GamInputData.UGP_OwnerListNew[1].OwnerName,n.GamInputData.Comment+=" "+n.GamInputData.UGP_OwnerListNew[1].OwnerLastName,n.GamInputData.Comment+="  |   کد ملی :  ",n.GamInputData.Comment+=" "+n.GamInputData.UGP_OwnerListNew[1].OwnerNationalCode,n.GamInputData.Comment+="  |   شماره همراه :  ",n.GamInputData.Comment+=" "+n.GamInputData.UGP_OwnerListNew[1].OwnerMobile,n.GamInputData.Comment+="  |   کد پستی :  ",n.GamInputData.Comment+=" "+n.GamInputData.UGP_OwnerListNew[1].OwnerPostCode,n.GamInputData.Comment+="  |   آدرس :  ",n.GamInputData.Comment+=" "+n.GamInputData.UGP_OwnerListNew[1].OwnerAddress));n.GamInputData.EditFich==!0&&(n.GamInputData.Comment+="\r\nتغییر اطلاعات فیش نوسازی");(typeof AddCommentTask=="undefined"||AddCommentTask!=!1&&n.GamInputData.CommentTask=="")&&(n.GamInputData.CommentTask=n.GamInputData.Comment);GetScope().GamInputData.G5r1!=undefined&&GetScope().GamInputData.G5r1!=""&&(n.GamInputData.CommentTask+="\r\n نوع استعلام : "+GetScope().GamInputData.G5r1);n.GamInputData.UGP_Owner_Comment!=undefined&&(n.GamInputData.CommentTask=n.GamInputData.UGP_Owner_Comment);n.GamInputData.NidBase==""&&(n.GamInputData.NidBase="00000000-0000-0000-0000-000000000000",n.GamInputData.NidNosaziCode="11041298-6050-435F-B863-FDC966021ADB",typeof NewNidNosaziCode!="undefined"&&(n.GamInputData.NidNosaziCode=NewNidNosaziCode),n.GamInputData.OwnerName!=undefined&&(n.GamInputData.Comment+="\r\nنام مالک:"+n.GamInputData.OwnerName));n.GamInputData.CurrentNosaziCode==""&&(n.GamInputData.HideCurrentNosaziCode=!0,i=n.GamInputData.District,n.GamInputData.CurrentNosaziCode=i+"-1000-1000-1000-0-0-0");n.GamInputData.ArchiveEntity=n.GamInputData.SelectedWorkFlow.Archive_NidEntity;n.GamInputData.QuestionnaireDetailFinal!=undefined&&(n.GamInputData.CI_ShahrsazRequestType=n.GamInputData.QuestionnaireDetailFinal.CI_ShahrsazRequestType);n.GamInputData.CI_DocType!=undefined&&n.GamInputData.CI_DocType!=null&&(n.GamInputData.Comment+="\r\nنوع سند : "+n.GamInputData.CI_DocType.Title+"/"+n.GamInputData.DocType);n.GamInputData.NosaziReasionsString!=null&&n.GamInputData.NosaziReasionsString.length>0&&(n.GamInputData.Comment+="\r\n"+n.GamInputData.NosaziReasionsString);i={pInputData:n.GamInputData,PRequestType:4};e=JSON.stringify(i);StartBusyCheckMark("mybody",'<p> درحال بررسی سوابق مدارک در سیستم شهرسازی<\/p><p>درحال محاسبه بدهی عوارض نوسازی<\/p><p> درحال ثبت درخواست <\/p><p style="Color:Red">در حال انجام کنترل های نهایی ، جهت ثبت درخواست .... <\/p>');$.ajax({type:"POST",url:"UTransferGam.aspx/StepSaveRequest",data:e,contentType:"application/json; charset=utf-8",dataType:"json",success:function(t){StopBusyCheckMark("mybody");AfterSaveRequest(t,!n.GamInputData.DontAddRevisitAgent);n.Functions.Gam2Func.FillEngineerInfo2();n.GamInputData.Wkt!=undefined&&n.GamInputData.Wkt!=""&&n.Functions.SaveWkt()},failure:function(){n.GamInputData.Comment="";StopBusyCheckMark("mybody");n.Prop.ErrorMessage="اطلاعات وارد شده اشتباه است . لطفا مجددا اقدام نمایید";n.$apply()},error:function(t){n.GamInputData.Comment="";StopBusyCheckMark("mybody");(t.responseText.indexOf("Cannot convert null to a value type")>-1||t.responseText.indexOf("Unrecognized Guid format")>-1)&&(n.Prop.ErrorMessage="اطلاعات وارد شده اشتباه است . لطفا مجددا اقدام نمایید",n.$apply())}})}},CheckError:function(t){return t.d!=undefined&&(t=t.d),t.ErrorResult.BizErrors.length>0?(n.Prop.ErrorMessage=t.ErrorResult.BizErrors[0].ErrorTitel,n.$apply(),!1):!0},ExportInquery:function(){n.Prop.ErrorMessage="";n.GamInputData.SelectedWorkFlow.Archive_NidEntity==undefined&&(n.GamInputData.SelectedWorkFlow.Archive_NidEntity=Archive_NidEntityParvaneh);var t={pNosaziCode:n.GamInputData.CurrentNosaziCode,NidProc:n.GamInputData.NidProc,NidAccount:ClsAccount.AccountInfo.NidAccount,ReportName:n.GamInputData.ReportName!=undefined?n.GamInputData.ReportName:"",pBizCodeArchive:n.GamInputData.ArchiveBizCode,pArchive_NidEntity:n.GamInputData.SelectedWorkFlow.Archive_NidEntity},i=JSON.stringify(t);StartBusy("divExport","در حال صدور گواهی ");$.ajax({type:"POST",url:"UStepGam.aspx/ExportInqueryWithChangeArchive",data:i,contentType:"application/json; charset=utf-8",dataType:"json",success:function(t){if(StopBusy("divExport"),t.d.ErrorResult.BizErrors.length>0)n.Prop.ErrorMessage=t.d.ErrorResult.BizErrors[0].ErrorTitel;else if(t.d.ErrorResult.HasErrors==!1){var i=n.GamInputData.NidProc;n.Functions.LoadInqueryArchive(i);n.GamInputData.NidProc=n.GamInputData.NidProc;$("#divShowArchive").show();$("#btnExport").hide();n.GreenColor=!0;n.GamInputData.IsExport=!0;GamPlugin.SavelocalStorage(n.Config.ScopeName,n.GamInputData);n.Prop.ErrorMessage=typeof ExportMessage=="undefined"?"مالک محترم شماره درخواست ملک "+n.GamInputData.NidWorkItem+" می باشد.خواهشمند است جهت طراحی و بارگذاری نقشه های ساختمانی خود ، شماره درخواست را در اختیار طراح خود قرار دهید ":ExportMessage;GamPlugin.ResetGam()}else n.Prop.ErrorMessage=ExportInquiryErrorMessage,n.GreenColor=!1;n.$apply()},failure:function(){StopBusy("divExport")},error:function(){StopBusy("divExport");n.Prop.ErrorMessage="خطا در ارسال اطلاعات";n.GreenColor=!1;n.$apply()}});n.$apply()},LoadInqueryArchive:function(n){var t=$("#divArchiveCert").AsSafaArchive();t.LoadObj(n,"ApprovalCertificate",1,{backgroundColor:"rgb(170, 219, 170)",FullpageBgColor:"rgb(170, 219, 170)",thumbnailGutterHeight:10,thumbnailGutterWidth:5,colorScheme:{navigationbar:{background:"yellow",border:"1px dotted #00cc00",color:"black",colorHover:"#fff"},thumbnail:{background:"rgb(180, 230, 190)",border:"1px solid yellow",labelBackground:"rgba(242, 242, 219, 0.33);",titleColor:"darkgreen",descriptionColor:"#ccc",descriptionShadow:"",paginationDotBorder:"2px solid #0c0",paginationDotBack:"#008500",paginationDotSelBack:"#0c0"}}});StartBusyTimer("divExport")},OnCheckedChanges:function(t){if(n.GamInputData.WorkFlowComments=[],t.Comments!=null&&t.Comments!=undefined){var i=t.Comments.split(";");i.length>1&&$.each(i,function(t,i){n.GamInputData.WorkFlowComments.push({Name:i,IsChecked:!1})})}SelectWorkFlowDeffByCombo&&(n.GamInputData.SelectedWorkFlow=t)},Estelamzabete:function(t){n.ZabetehDetails=null;n.ZabetehChideman=null;StartBusy("GridViewTarakom","در حال دریافت اطلاعات کاربری");var i={pCode:n.GamInputData.CurrentNosaziCode},r=JSON.stringify(i);n.myVar=!1;n.isBusy=!0;n.MapInfo=null;n.$apply();$request=$.ajax({type:"POST",url:ServiceAddress+"GetZabeteh_MapInfoAndPlan",data:r,crossDomin:!0,contentType:"application/json; charset=utf-8",dataType:"json",processdata:!0,success:function(i){StopBusy("GridViewTarakom");n.isBusy=!1;t&&i.ErrorResult.BizErrors.length>0&&i.ErrorResult.BizErrors[0].ErrorAction==1&&(n.Prop.ErrorMessageZabeteh=i.ErrorResult.BizErrors[0].ErrorTitel);n.Base_PlanMosavab=i.Base_PlanMosavab;n.Base_PlanMojaz=i.Base_PlanMojaz;n.MapInfo=i.MapInfo;n.myVar=!n.myVar;$(".LowOpacity").css("opacity","1");n.$apply()},error:function(){n.isBusy=!1;n.MapInfo=null;n.$apply()}})},Estelamzabete2:function(){n.Prop.ErrorMessage="";document.getElementById("divZavabeh").style.display="block";StartBusy("CtlZabtehId","");var t={pCode:n.GamInputData.CurrentNosaziCode},i=JSON.stringify(t);n.Prop.ErrorMessage=null;$.ajax({type:"POST",url:ServiceAddress+"GetZabeteh_DetailsAndChideman",data:i,crossDomin:!0,contentType:"application/json; charset=utf-8",dataType:"json",processdata:!0,success:function(t){StopBusy("CtlZabtehId");t.ErrorResult.BizErrors.length>0?n.Prop.ErrorMessage=t.ErrorResult.BizErrors[0].ErrorTitel:(n.Base_FrontList=t.ZabetehChideman.Base_FrontList,n.Base_UsingList=t.ZabetehChideman.Base_UsingList,n.ZabetehChideman=t.ZabetehChideman,n.ZabetehDetails=t.ZabetehDetails);n.$apply()},error:function(){n.Prop.ErrorMessage="خطا در اجرای سرویس"}})},EstelamzabeteCrowd:function(){n.Prop.ErrorMessage="";document.getElementById("divZavabeh").style.display="block";StartBusy("CtlZabtehId","");var t={pCode:n.GamInputData.CurrentNosaziCode},i=JSON.stringify(t);n.Prop.ErrorMessage=null;$.ajax({type:"POST",url:ServiceAddress+"GetZabeteh",data:i,crossDomin:!0,contentType:"application/json; charset=utf-8",dataType:"json",processdata:!0,success:function(t){StopBusy("CtlZabtehId");t.ErrorResult.BizErrors.length>0?n.Prop.ErrorMessage=t.ErrorResult.BizErrors[0].ErrorTitel:(n.Base_FrontList=t.ZabetehChideman.Base_FrontList,n.Base_UsingList=t.ZabetehChideman.Base_UsingList,n.ZabetehChideman=t.ZabetehChideman,n.ZabetehDetails=t.ZabetehDetails);n.$apply()},error:function(){n.Prop.ErrorMessage="خطا در اجرای سرویس"}})},LoadZabeteh:function(){var i={pDistrict:n.GamInputData.District,pNidProc:n.GamInputData.NidProc},t;$("#Zabete").hide();n.Functions.LoadZabetehMapInfo();t=JSON.stringify(i);StartBusy("divZabeteMain","در حال دریافت اطلاعات");$.ajax({type:"POST",url:ServiceAddress+"LoadZabeteh",data:t,contentType:"application/json; charset=utf-8",dataType:"json",success:function(t){t.ErrorResult.BizErrors.length>0?(n.Prop.ErrorMessage="شهروند گرامی اعلام ضابطه بروی درخواست شما از طرف شهرداری انجام نشده است",$("#Zabete").hide(),n.$apply(),StopBusy("divZabeteMain")):n.Functions.GetPlanOrder()},failure:function(){StopBusy("divZabeteMain")},error:function(){StopBusy("divZabeteMain")}})},LoadZabetehMapInfo:function(){var t={pCode:n.GamInputData.CurrentNosaziCode},i=JSON.stringify(t);n.MapInfo=null;$request=$.ajax({type:"POST",url:ServiceAddress+"GetZabeteh_MapInfoAndPlan",data:i,crossDomin:!0,contentType:"application/json; charset=utf-8",dataType:"json",processdata:!0,success:function(t){n.MapInfo=t.MapInfo;n.Base_PlanMosavab=t.Base_PlanMosavab;n.Base_PlanMojaz=t.Base_PlanMojaz;n.$apply()},error:function(){n.MapInfo=null;n.$apply()}})},GetPlanOrder:function(){var i={pDistrict:n.GamInputData.District,pNidProc:n.GamInputData.NidProc},t;$("#Zabete").hide();n.Functions.LoadZabetehMapInfo();t=JSON.stringify(i);StartBusy("divZabeteMain","در حال دریافت اطلاعات");$.ajax({type:"POST",url:ServiceAddress+"GetPlanOrder",data:t,contentType:"application/json; charset=utf-8",dataType:"json",success:function(t){t.ErrorResult.BizErrors.length>0?(n.Prop.ErrorMessage="شهروند گرامی اعلام ضابطه بروی درخواست شما از طرف شهرداری انجام نشده است",$("#Zabete").hide(),n.$apply()):($("#Zabete").show(),t.Base_PlanMosavab!=null&&(n.Base_PlanMosavab=t.Base_PlanMosavab[0]),t.Base_PlanMojaz!=null&&(n.Base_PlanMojaz=t.Base_PlanMojaz[0]),n.Base_UsingList=t.Base_Using_MapContol,n.Base_FrontList=t.Base_Front_MapContol,n.GetOwnerZabetehComment(),n.$apply(),ReEvent());StopBusy("divZabeteMain")},failure:function(){StopBusy("divZabeteMain")},error:function(){StopBusy("divZabeteMain")}})},CalculateZabeteh_AndSave:function(){n.Prop.ErrorMessage="";var t={pNidProc:n.GamInputData.NidProc,pDistrict:n.GamInputData.District},i=JSON.stringify(t);n.Prop.ErrorMessage=null;$.ajax({type:"POST",url:ServiceAddress+"CalculateZabeteh_AndSave",data:i,crossDomin:!0,contentType:"application/json; charset=utf-8",dataType:"json",processdata:!0,success:function(){},error:function(){}})},GetTavafoghat:function(){var t,i,r;document.getElementById("divZavabeh").style.display="block";StartBusy("grdTavafoghat","");t={pNidProc:n.GamInputData.NidProc};i=JSON.stringify(t);n.Prop.ErrorMessage=null;r=GetUrlByDomain(SrvSC,n.GamInputData.District);$.ajax({type:"POST",url:r+"GetSh_Agreement_ListWithHistory",data:i,crossDomin:!0,contentType:"application/json; charset=utf-8",dataType:"json",processdata:!0,success:function(t){StopBusy("grdTavafoghat");t.ErrorResult.BizErrors.length>0?n.Prop.ErrorMessage=t.ErrorResult.BizErrors[0].ErrorTitel:n.Sh_Agreement_List=t.Sh_Agreement_List;n.$apply()},error:function(){n.Prop.ErrorMessage="خطا در اجرای سرویس"}})},SendSmsRevisitAgent:function(){try{var t={pInputData:n.GamInputData},i=JSON.stringify(t);$.ajax({type:"POST",url:"UTransferGam.aspx/SendSMSAgent",data:i,crossDomin:!0,contentType:"application/json; charset=utf-8",dataType:"json",processdata:!0,success:function(){},error:function(){}})}catch(r){}},ShowArchive:function(){$("#DivArchiveSend").show();var t=$("#DivArchiveSend").AsSafaArchive();t.LoadObj(n.GamInputData.ArchiveBizCode,n.GamInputData.District,1,{backgroundColor:"rgb(170, 219, 170)",FullpageBgColor:"rgb(170, 219, 170)",thumbnailGutterHeight:10,thumbnailGutterWidth:5,Archive_NidEntity:Archive_NidEntitySend,colorScheme:{navigationbar:{background:"yellow",border:"1px dotted #00cc00",color:"black",colorHover:"#fff"},thumbnail:{background:"rgb(180, 230, 190)",border:"1px solid yellow",labelBackground:"rgba(242, 242, 219, 0.33);",titleColor:"darkgreen",descriptionColor:"#ccc",descriptionShadow:"",paginationDotBorder:"2px solid #0c0",paginationDotBack:"#008500",paginationDotSelBack:"#0c0"}}},function(){})},ShowArchiveReport:function(){var t=$("#DivArchiveShfaniReport").AsSafaArchive();t.LoadObj(n.GamInputData.ArchiveBizCode,n.GamInputData.District,1,{backgroundColor:"rgb(170, 219, 170)",FullpageBgColor:"rgb(170, 219, 170)",thumbnailGutterHeight:10,thumbnailGutterWidth:5,Archive_NidEntity:0,colorScheme:{navigationbar:{background:"yellow",border:"1px dotted #00cc00",color:"black",colorHover:"#fff"},thumbnail:{background:"rgb(180, 230, 190)",border:"1px solid yellow",labelBackground:"rgba(242, 242, 219, 0.33);",titleColor:"darkgreen",descriptionColor:"#ccc",descriptionShadow:"",paginationDotBorder:"2px solid #0c0",paginationDotBack:"#008500",paginationDotSelBack:"#0c0"}}},function(){})},ShowArchiveLetter:function(){var t=$("#DivArchiveLetter").AsSafaArchive();t.LoadObj(n.GamInputData.ArchiveBizCode,n.GamInputData.District,1,{backgroundColor:"rgb(170, 219, 170)",FullpageBgColor:"rgb(170, 219, 170)",thumbnailGutterHeight:10,thumbnailGutterWidth:5,Archive_NidEntity:Archive_NidEntityLetter,colorScheme:{navigationbar:{background:"yellow",border:"1px dotted #00cc00",color:"black",colorHover:"#fff"},thumbnail:{background:"rgb(180, 230, 190)",border:"1px solid yellow",labelBackground:"rgba(242, 242, 219, 0.33);",titleColor:"darkgreen",descriptionColor:"#ccc",descriptionShadow:"",paginationDotBorder:"2px solid #0c0",paginationDotBack:"#008500",paginationDotSelBack:"#0c0"}}},function(){})},GamTahodatFunc:{GetCommitmentCitizen:function(){n.Prop.ErrorMessage=null;var t={pDistrict:n.GamInputData.District,pNidProc:n.GamInputData.NidProc},i=JSON.stringify(t);StartBusy1("درحال دریافت اطلاعات");$.ajax({data:i,type:"POST",url:ServiceAddress+"GetSh_CommitmentCitizen",crossDomin:!0,contentType:"application/json; charset=utf-8",dataType:"json",processdata:!0,success:function(t){StopBusy1();n.Functions.CheckError(t)&&(n.Sh_CommitmentCitizenList=t.Sh_CommitmentCitizenList,n.$apply())},error:function(){StopBusy1()}})},SaveCommitmentCitizen:function(){n.Prop.ErrorMessage=null;n.Sh_CommitmentCitizenList=Enumerable.From(n.Sh_CommitmentCitizenList).Select(function(n){return n.Sh_CommitmentCitizen}).ToArray();n.Sh_CommitmentCitizenList=JSON.parse(angular.toJson(n.Sh_CommitmentCitizenList));var t={pDistrict:n.GamInputData.District,pNidProc:n.GamInputData.NidProc,pSh_CommitmentCitizenList:n.Sh_CommitmentCitizenList},i=JSON.stringify(t);StartBusy1("درحال دریافت اطلاعات");$.ajax({data:i,type:"POST",url:ServiceAddress+"SaveSh_CommitmentCitizen",crossDomin:!0,contentType:"application/json; charset=utf-8",dataType:"json",processdata:!0,success:function(t){StopBusy1();n.Functions.CheckError(t)&&(n.Functions.GamTahodatFunc.GetCommitmentCitizen(),n.Prop.ErrorMessageComment="اطلاعات با موفقیت ذخیره شد",n.ErrorColor="Green")},error:function(){StopBusy1()}})},ConfirmCitizen:function(n){n.Sh_CommitmentCitizen.IsConfirmByCitizen=1;var t=persianDate().pDate;n.Sh_CommitmentCitizen.CitizenConfirmDate=t.year+"/"+t.month+"/"+t.date;n.Sh_CommitmentCitizen.CitizenConfirmTime=t.hours+":"+t.minutes+":"+t.seconds;n.Sh_CommitmentCitizen.NidUserCitizen=ClsAccount.AccountInfo.NidAccount;n.Sh_CommitmentCitizen.CitizenUserName=ClsAccount.AccountInfo.FullName;n.Sh_CommitmentCitizen.CitizenNationalCode=ClsAccount.AccountInfo.OwnerNationalCode},ShowHistory:function(){$("#GridHistory").show();n.Prop.ErrorMessage=null;var t={pDistrict:n.GamInputData.District,pNidProc:n.GamInputData.NidProc},i=JSON.stringify(t);StartBusy1("درحال دریافت اطلاعات");$.ajax({data:i,type:"POST",url:ServiceAddress+"GetSh_CheckList",crossDomin:!0,contentType:"application/json; charset=utf-8",dataType:"json",processdata:!0,success:function(t){StopBusy1();n.Functions.CheckError(t)&&(n.Sh_CheckList=t.Sh_CheckList,n.$apply())},error:function(){StopBusy1()}})}},ConfirmOnFormsConfirmation:function(t){var i={pFormsConfirmationType:t,pNidProc:n.GamInputData.NidProc,pDistrict:n.GamInputData.District,IsConfirmByCitizen:!0,EumUrbanPlannerOpinion:1,CitizenComments:"تایید شهروند"},r=JSON.stringify(i);StartBusy("Div5","در حال بررسی سوابق");$.ajax({type:"POST",url:ServiceAddress+"ConfirmOnFormsConfirmation",data:r,crossDomin:!0,contentType:"application/json; charset=utf-8",dataType:"json",processdata:!0,success:function(){},error:function(){}})},CheckLetters:function(){var f=GamsArray[GamPlugin.CurrentStep],t=!0,e=Enumerable.From(n.LetterList_OUT).Where(function(n){return n.Sh_OfficeLetter.EumConfirm==1&&n.Sh_OfficeLetter.CI_OfficeLetter}).Count(),r=Enumerable.From(n.LetterList_OUT).Where(function(n){return n.Sh_OfficeLetter.EumConfirm==2&&n.Sh_OfficeLetter.ArchiveNidFile!=null}).Count(),u,i,o;return r!=undefined&&r>0&&(n.GamInputData.MustUploadLetterCount=n.GamInputData.MustUploadLetterCount-r),u=Enumerable.From(n.LetterList_IN).Where(function(n){return n.Sh_OfficeLetter.EumConfirmOrganization==1}).Count(),i=Enumerable.From(n.LetterList_IN).Where(function(n){return n.Sh_OfficeLetter.CI_OfficeLetter!=25||n.Sh_OfficeLetter.CI_OfficeLetter!=26}).Count(),n.tmpConfirmLetterIn=!0,u<i?(n.Prop.ErrorMessage+="\r\nتمام نامه های درون سازمانی باید مورد تایید شهرساز قرار گیرند",t=!1,$("#btnSendToShahrsaz3").prop("disabled",!0),n.GreenColor=!1,n.tmpConfirmLetterIn=!1):f.Name!="MokatebatDastoor"&&e<n.LetterList_OUT.length&&(n.GamInputData.MustUploadLetterCount==undefined||n.GamInputData.MustUploadLetterCount<n.LetterList_OUT.length)?(n.Prop.ErrorMessage="لطفا نامه های برون سازمانی را بارگذاری نمایید",t=!1):f.Name!="MokatebatDastoor"&&e<n.LetterList_OUT.length?(n.Prop.ErrorMessage+="\r\nتمام نامه های برون سازمانی باید مورد تایید شهرساز قرار گیرند - پرونده را به شهرداری ارسال نمایید",t=!1):n.GamInputData.UploadDwg!=!0?(n.Prop.ErrorMessage+="\r\nفایل پیش نقشه باید بارگذاری شود",t=!1):i>0&&u>=i?$("#btnSendToShahrsaz3").show():$("#btnSendToShahrsaz3").hide(),n.LetterList_New.length>0&&n.GamInputData.SendToShahrsazOk5!=!0?(n.Prop.ErrorMessage="ابتدا دکمه ارسال به شهرداری را بزنید ",$("#btnSendToShahrsaz5").prop("disabled",!1),t=!1):(o=Enumerable.From(n.LetterList_New).Where(function(n){return n.Sh_OfficeLetter.EumConfirm==1}).Count(),o<n.LetterList_New.length?(n.Prop.ErrorMessage="تمامی مدارک باید مورد تایید شهرداری قرار گیرد",t=!1):n.GamInputData.tmpConfirmLetterNewOk=!0),n.$apply(),t},CheckLettersLoad:function(){var t=GamsArray[GamPlugin.CurrentStep],u=Enumerable.From(n.LetterList_IN).Where(function(n){return n.Sh_OfficeLetter.EumConfirmOrganization==1&&n.Sh_OfficeLetter.CI_OfficeLetter!=25&&n.Sh_OfficeLetter.CI_OfficeLetter!=26}).Count(),i=Enumerable.From(n.LetterList_IN).Where(function(n){return n.Sh_OfficeLetter.CI_OfficeLetter!=25&&n.Sh_OfficeLetter.CI_OfficeLetter!=26}).Count(),r;if(n.tmpConfirmLetterIn=!0,u<i?(n.Prop.ErrorMessage+="\r\nتمام نامه های درون سازمانی باید مورد تایید شهرساز قرار گیرند",$("#btnSendToShahrsaz3").prop("disabled",!0),$("#btnSendToShahrsaz3").hide(),n.GreenColor=!1):i>0&&u>=i&&($("#btnSendToShahrsaz3").show(),$("#btnSendToShahrsaz3").prop("disabled",!1)),n.LetterList_IN.length==0&&n.LetterList_OUT==0&&($("#btnSendToShahrsaz3").show(),$("#btnSendToShahrsaz3").prop("disabled",!1)),(typeof CI_City!=undefined&&CI_City==2&&n.GamInputData.MustUploadLetterCountCom<n.LetterList_Com.length||t.MustUploadLetterComThenSendToShahsaz!=undefined&&t.MustUploadLetterComThenSendToShahsaz==!0)&&$("#btnSendToShahrsazCom").hide(),t.Name==EumPage.Commission&&n.LetterList_Com!=null&&n.LetterList_Com.length>0){var f=Enumerable.From(n.LetterList_Com).Where(function(n){return n.LetterName=="ارائه نقشه معماري / کميسيون شهرسازي"}).ToArray(),e=Enumerable.From(f).Where(function(n){return n.Sh_OfficeLetter.EumConfirm==1}).Count(),o=Enumerable.From(n.LetterList_Com).Where(function(n){return n.Sh_OfficeLetter.CI_OfficeLetter==49}).ToArray(),s=Enumerable.From(o).Where(function(n){return n.Sh_OfficeLetter.EumConfirm==1}).Count();n.Functions.CheckConfirmManager(GamPlugin.CurrentStep)&&(e>=1&&s>=1?$("#btnSendToShahrsazCom").show():$("#btnSendToShahrsazCom").hide())}t.Name==EumPage.Mokatebat&&n.LetterList_New.length>0&&(r=Enumerable.From(n.LetterList_New).Where(function(n){return n.Sh_OfficeLetter.ArchiveNidFile!=null}).Count(),r!=undefined&&r==n.LetterList_New.length&&($("#btnSendToShahrsaz3").show(),$("#btnSendToShahrsaz3").prop("disabled",!1)));n.$apply()},ShowShReport:function(){this.ShowShReport2()},ShowShReport2:function(){var t,i;StartBusyTimer();n.GamInputData.RenderNames!=undefined&&n.GamInputData.RenderNames.length>0&&!1?(n.Functions.ShowArchiveReport(),$("html, body").animate({scrollTop:$("#DivArchiveSend").offset().top},2e3)):(StartBusy1(),t={NidProc:GetScope().GamInputData.NidProc,pNidEntity:0,NosaziCode:GetScope().GamInputData.CurrentNosaziCode,pArchiveBizCode:GetScope().GamInputData.ArchiveBizCode!=undefined?GetScope().GamInputData.ArchiveBizCode:"",NidNosaziCode:GetScope().GamInputData.NidNosaziCode,pFileName:"Output_Parvaneh"+GetScope().GamInputData.NidProc.split("-")[1]},n.Prop.ErrorMessage="",i=JSON.stringify(t),StartBusy("divArchiveCert","در حال ایجاد گزارش"),$.ajax({type:"POST",url:"UTransferGam.aspx/RenderReport",data:i,contentType:"application/json; charset=utf-8",dataType:"json",success:function(t){StopBusy1();t.d.ErrorResult.BizErrors.length>1?n.Prop.ErrorMessage=t.d.ErrorResult.BizErrors[1].ErrorTitel:t.d.ErrorResult.BizErrors.length>0?n.Prop.ErrorMessage=t.d.ErrorResult.BizErrors[0].ErrorTitel:(n.Functions.ShowArchiveReport(),n.GamInputData.RenderNames=t.d.renderNames);n.$apply();GamPlugin.SavelocalStorage(n.Config.ScopeName,n.GamInputData);$("html, body").animate({scrollTop:$("#DivArchiveSend").offset().top},2e3)}}))},ShowZabeteReport:function(){var n="RptZabeteSh&ReportParameter=NidProc;"+GetScope().GamInputData.NidProc+",District;"+GetScope().GamInputData.District+",TokenKey;";window.open(FactorUrl+n,"_blank")},ShowPreAvarez:function(n){var t="RptPreAvarez&ReportParameter=NosaziCode;"+GetScope().GamInputData.CurrentNosaziCode+",District;"+GetScope().GamInputData.District+",NidFiche;"+n+",TokenKey;";window.open(FactorUrl+t,"_blank")},RevokeRequest:function(){var t={pDomain:n.GamInputData.District,pComments:$("#reasonComment").val(),pNidProc:n.GamInputData.NidProc},i=JSON.stringify(t);StartBusy("Div5","در حال بررسی سوابق");$.ajax({type:"POST",url:ServiceAddress+"SendToGarbageKartabl",data:i,crossDomin:!0,contentType:"application/json; charset=utf-8",dataType:"json",processdata:!0,success:function(){GamPlugin.ResetGamAndRedirect()},error:function(){}})},LoadMapControl:function(){var t={pDistrict:n.GamInputData.District,pNidProc:n.GamInputData.NidProc},i=JSON.stringify(t);StartBusy("MainGam","در حال بازآوری اطلاعات");$.ajax({type:"POST",url:ServiceAddress+"GetMapControl",data:i,crossDomin:!0,contentType:"application/json; charset=utf-8",dataType:"json",processdata:!0,success:function(t){n.Base_FrontList=t.Base_Front_MapContol;n.Base_UsingList=t.Base_Using_MapContol;n.$apply();StopBusy("MainGam")},error:function(){StopBusy("GridViewTarakom")}})},GetNewNosaziCode:function(){var t={pDomain:n.GamInputData.District,pNidProc:n.GamInputData.NidProc},i=JSON.stringify(t);StartBusy("MainGam","در حال دریافت کد نوسازی");$.ajax({type:"POST",url:ServiceAddress+"GetSh_NewNosaziCode",data:i,crossDomin:!0,contentType:"application/json; charset=utf-8",dataType:"json",processdata:!0,success:function(t){var i=t.Sh_NewNosaziCode;n.GamInputData.CurrentNosaziCode=i.District+"-"+i.Region+"-"+i.Block+"-"+i.House+"-"+i.Building+"-"+i.Apartment+"-"+i.Shop;n.$apply();StopBusy("MainGam")},error:function(){StopBusy("MainGam")}})},SaveWkt:function(){var t={NidProc:n.GamInputData.NidProc,WKT:n.GamInputData.Wkt,pDomain:n.GamInputData.District},i=JSON.stringify(t);$.ajax({type:"POST",url:ServiceAddress+"SaveSh_NewNosaziCode",data:i,crossDomin:!0,contentType:"application/json; charset=utf-8",dataType:"json",processdata:!0,success:function(){},error:function(){}})},GetNahadList:function(){$request=$.ajax({type:"POST",url:"UStepGam.aspx/GetNahadList",crossDomin:!0,contentType:"application/json; charset=utf-8",dataType:"json",processdata:!0,success:function(t){t.d!=null&&(n.GamInputData.CI_EntityList=t.d.CI_EntityList,n.$apply())},error:function(n){StopBusy("divUploader");var t=n}})}};n.SetDisableButton=function(){n.GamInputData.AllowNextPage=!1};n.Prop={ErrorMessage:null,CurrentPageName:null,WorkflowList:null};n.StyleFunc={tmpWidthGam:0,GamWidth:0,GamWidth2:0,IsGraet:!1,GetDefaultWidth:function(){if(typeof GamsArray!="undefined")this.GamWidth=(100/GamsArray.length).toFixed(1),this.GamWidth2=document.body.clientWidth*(100/(GamsArray.length-1)).toFixed(1)/100;else return"10"},GetWidth:function(n){var t="10%",i="right",r="right",u;return n==GamsArray.length-1?(t="70px",i="left",r="left"):n==GamsArray.length-2?(t=this.GamWidth2+"px",tmpWidthGam=t):(u=this.GamWidth,t=u+"%"),styles={width:t,"text-align":r,float:i}},Getalign:function(n){var t="center";return n==GamsArray.length-1&&(t="left"),n==0&&(t="right"),styles={"text-align":t,direction:"ltr"}},Getalign2:function(n){var t="center",i="0",t="right";return n==0&&(t="right"),n==GamsArray.length-1&&(t="left",i="5px",tmpFloat="left"),styles={"text-align":t,direction:"ltr","margin-left":i}},GetFloat:function(n){var t="none",i="right";return n==GamsArray.length-1&&(t="left"),n>0&&n<GamsArray.length-1&&(i="center"),styles={float:t,"text-align":i}},Load:function(){typeof GamsArray!="undefined"&&(this.tmpWidthGam=100,this.GetDefaultWidth(),$(".step-div").length==GamsArray.length&&$(window).resize(function(){}))}};n.templateUrl=function(n){return(n==null||n=="")&&(n=".htm"),"Parvaneh/"+n};n.ShowPrint=typeof ShowPrint!="undefined"&&ShowPrint==!0;n.HideFishDarAmadDetail=typeof HideFishDarAmadDetail!="undefined"&&HideFishDarAmadDetail==!1;n.ChangeShFani=function(){};n.ChangeZabeteOk=function(){};n.RequestType=[{index:1,id:1,Name:"کاهش بنا"},{index:1,id:2,Name:"کاهش واحد"},{index:1,id:3,Name:"کاهش طبقه"},{index:2,id:4,Name:"اضافه بنا"},{index:2,id:5,Name:"اضافه واحد"},{index:2,id:6,Name:"اضافه طبقه"}];n.EumFloor=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20];n.LetterList=[];n.ShowLetterReport=function(n){var t=FactorUrl+n+"&ReportParameter=NidProc;"+GetScope().GamInputData.NidProc+",District;"+GetScope().GamInputData.District+",TokenKey;,NIdUser;"+GetScope().NidUser+"";window.open(t,"_blank")};n.ShowReport=function(n){var t=n+"&ReportParameter=NidProc;"+GetScope().GamInputData.NidProc+",District;"+GetScope().GamInputData.District+",TokenKey;,NIdUser;"+GetScope().NidUser+"";window.open(FactorUrl+t,"_blank")};n.ShowReportValidity=function(n){var t=n+"&ReportParameter=District;"+GetScope().GamInputData.District+"NosaziCode;"+GetScope().GamInputData.CurrentNosaziCode;window.open(FactorUrl+t,"_blank")};n.LoadLetter=function(){n.Prop.ErrorMessage="";var t={pDistrict:n.GamInputData.District,pNidProc:n.GamInputData.NidProc},i=JSON.stringify(t);StartBusy("divLetters","در حال بارآوری نامه ها");$.ajax({type:"POST",url:ServiceAddress+"GetSh_OfficeLetter",data:i,contentType:"application/json; charset=utf-8",dataType:"json",success:function(t){if(StopBusy("divLetters"),t.ErrorResult.BizErrors.length>0)n.Prop.ErrorMessage="خطا در دریافت اطلاعات";else{n.LetterList_IN=Enumerable.From(t.Sh_OfficeLetterResult).Where(function(n){return n.EumOfficeLetterType==1}).ToArray();n.LetterList_OUT=Enumerable.From(t.Sh_OfficeLetterResult).Where(function(n){return n.EumOfficeLetterType==2}).ToArray();n.LetterList_PZ=Enumerable.From(t.Sh_OfficeLetterResult).Where(function(n){return n.EumOfficeLetterType==3}).ToArray();n.LetterList_Ag=Enumerable.From(t.Sh_OfficeLetterResult).Where(function(n){return n.EumOfficeLetterType==4}).ToArray();n.LetterList_New=Enumerable.From(t.Sh_OfficeLetterResult).Where(function(n){return n.EumOfficeLetterType==6}).ToArray();n.$apply();n.GamInputData.IsNew==!0?n.LetterList_New.forEach(function(t,i){var r=n.GamInputData.SelectedWorkFlow.Archive_NidEntity,u=$("#DivUploadNew"+i).AsSafaArchiveUploder();u.LoadObjSimple(ClsAccount.AccountInfo.NidAccount,"UGP",{UserName:ClsAccount.AccountInfo.FullName,UserCode:ClsAccount.AccountInfo.NidAccount,LoadNidFile:t.Sh_OfficeLetter.ArchiveNidFile,Multiply:!0,NidTag:r,DetectObject:!1,MinFileSize:Upload_MinFileSize,MaxFileSize:Upload_MaxFileSize,Title:"",IsRequire:!0,OtherFiled:t.Sh_OfficeLetter.NidOfficeLetter,FilterExtensions:typeof FileExt!="undefined"?FileExt:".png,.jpg",SaveOrginalFile:!0,OnCompleteUpload:function(t){n.Functions.Gam5Func_Upload.AddNidFileLetterNew(t.NidFile,t.OtherFiled,r)}})}):n.LetterList_New.forEach(function(t,i){var r=n.GamInputData.SelectedWorkFlow.Archive_NidEntity,u=$("#DivUploadNew"+i).AsSafaArchiveUploder();u.LoadObjSimple(n.GamInputData.ArchiveBizCode,n.GamInputData.District,{UserName:ClsAccount.AccountInfo.FullName,UserCode:ClsAccount.AccountInfo.NidAccount,LoadNidFile:t.Sh_OfficeLetter.ArchiveNidFile,Multiply:!0,NidTag:r,DetectObject:!1,MinFileSize:Upload_MinFileSize,MaxFileSize:Upload_MaxFileSize,Title:"",IsRequire:!0,OtherFiled:t.Sh_OfficeLetter.NidOfficeLetter,FilterExtensions:typeof FileExt!="undefined"?FileExt:".png,.jpg",SaveOrginalFile:!0,OnCompleteUpload:function(t){n.Functions.Gam5Func_Upload.AddNidFileLetterNew(t.NidFile,t.OtherFiled,r)}})});n.$apply();var i=Enumerable.From(n.LetterList_OUT).Where(function(n){return n.Sh_OfficeLetter.EumConfirm==1}).ToArray().length;n.LetterList_OUT.forEach(function(t,r){if(t.IsConfirmStr=t.Sh_OfficeLetter.EumConfirm==1?"تایید":"عدم تایید",i!=n.LetterList_OUT.length){var u=Archive_NidEntityLetter,f=$("#DivLetter"+r).AsSafaArchiveUploder();f.LoadObjSimple(n.GamInputData.ArchiveBizCode,n.GamInputData.District,{UserName:ClsAccount.AccountInfo.FullName,UserCode:ClsAccount.AccountInfo.NidAccount,FilterExtensions:typeof FileExt!="undefined"?FileExt:".png,.jpg",Multiply:!0,NidTag:u,DetectObject:!1,MinFileSize:Upload_MinFileSize,MaxFileSize:Upload_MaxFileSize,Title:"",IsRequire:!0,OtherFiled:t.Sh_OfficeLetter.NidOfficeLetter,OnCompleteUpload:function(i){n.Functions.Gam5Func_Upload.AddNidFileLetter(i.NidFile,i.OtherFiled,t);n.Functions.ShowArchiveLetter()}})}});(n.LetterList_PZ==undefined||n.LetterList_PZ.length==0)&&(n.GamInputData.UploadDwg=!0);n.LetterList_PZ.forEach(function(t,i){var r=Archive_NidEntityDwg,u=$("#DivLetterDWG"+i).AsSafaArchiveUploder();u.LoadObjSimple(n.GamInputData.ArchiveBizCode,n.GamInputData.District,{UserName:ClsAccount.AccountInfo.FullName,UserCode:ClsAccount.AccountInfo.NidAccount,Multiply:!0,NidTag:r,DetectObject:!1,MinFileSize:Upload_MinFileSize,MaxFileSize:Upload_MaxFileSize,Title:"",IsRequire:!0,OtherFiled:t.Sh_OfficeLetter.NidOfficeLetter,FilterExtensions:".dwg,.Rvt",SaveOrginalFile:!0,OnCompleteUpload:function(t){n.GamInputData.UploadDwg=!0;n.Functions.Gam5Func_Upload.AddNidFileLetter(t.NidFile,t.OtherFiled,!0);n.Functions.ShowArchiveLetter()}})});n.LetterList_Com=Enumerable.From(t.Sh_OfficeLetterResult).Where(function(n){return n.EumOfficeLetterType==5}).ToArray();n.$apply();n.LetterList_Com.forEach(function(t,i){t.IsConfirmStr=t.Sh_OfficeLetter.IsConfirm?"تایید":"عدم تایید";var r=Archive_NidEntityDwg,u=$("#DivLetterCom"+i).AsSafaArchiveUploder();u.LoadObjSimple(n.GamInputData.ArchiveBizCode,n.GamInputData.District,{UserName:ClsAccount.AccountInfo.FullName,UserCode:ClsAccount.AccountInfo.NidAccount,LoadNidFile:t.Sh_OfficeLetter.ArchiveNidFile,Multiply:!0,NidTag:r,DetectObject:!1,MinFileSize:typeof Upload_MinFileSizeCad!="undefined"?Upload_MinFileSizeCad:Upload_MinFileSize,MaxFileSize:typeof Upload_MaxFileSizeCad!="undefined"?Upload_MaxFileSizeCad:Upload_MaxFileSize,Title:"",IsRequire:!0,OtherFiled:t.Sh_OfficeLetter.NidOfficeLetter,FilterExtensions:".dwg,.Rvt",OnCompleteUpload:function(t){n.Functions.Gam5Func_Upload.AddNidFileLetterCom(t.NidFile,t.OtherFiled)}})});n.Functions.CheckLettersLoad();n.$apply()}},failure:function(){StopBusy("divLetters")},error:function(){StopBusy("divLetters")}})};n.LoadLetterCom=function(){n.Prop.ErrorMessage="";var t={pDistrict:n.GamInputData.District,pNidProc:n.GamInputData.NidProc},i=JSON.stringify(t);StartBusy("divSendData","در حال نمایش نامه ها");$.ajax({type:"POST",url:ServiceAddress+"GetSh_OfficeLetter",data:i,contentType:"application/json; charset=utf-8",dataType:"json",success:function(t){StopBusy("divSendData");t.ErrorResult.BizErrors.length>0?n.Prop.ErrorMessage="خطا در دریافت اطلاعات":(n.LetterList=t.Sh_OfficeLetterResult,n.LetterList_Com=Enumerable.From(t.Sh_OfficeLetterResult).Where(function(n){return n.EumOfficeLetterType==5}).ToArray(),n.$apply(),n.LetterList_Com.forEach(function(t,i){t.IsConfirmStr=t.Sh_OfficeLetter.IsConfirm?"تایید":"عدم تایید";var r=Archive_NidEntityDwg,u=$("#DivLetterCom"+i).AsSafaArchiveUploder();u.LoadObjSimple(n.GamInputData.ArchiveBizCode,n.GamInputData.District,{UserName:ClsAccount.AccountInfo.FullName,UserCode:ClsAccount.AccountInfo.NidAccount,LoadNidFile:t.Sh_OfficeLetter.ArchiveNidFile,Multiply:!0,NidTag:r,DetectObject:!1,MinFileSize:Upload_MinFileSize,MaxFileSize:Upload_MaxFileSize,Title:"",IsRequire:!0,OtherFiled:t.Sh_OfficeLetter.NidOfficeLetter,FilterExtensions:".dwg,.Rvt",OnCompleteUpload:function(t){n.Functions.Gam5Func_Upload.AddNidFileLetterCom(t.NidFile,t.OtherFiled)}})}))},failure:function(){StopBusy("divSendData")},error:function(){StopBusy("divSendData")}})};n.AddRequestType=function(){n.UGP_FormsConfirmationListZabete.push({UGP_FormsConfirmation:{EumFormsConfirmationType:1,IsNew:!0}});$("#btnZabeteComment").prop("disabled",!1);ReEvent()};n.RemoveRequestType=function(t){t.UGP_FormsConfirmation.NidFormsConfirmation==undefined?(dictionary=Enumerable.From(n.UGP_FormsConfirmationListZabete).ToDictionary(),dictionary.Remove(t),n.UGP_FormsConfirmationListZabete=dictionary.ToEnumerable().Select(n=>n.Key).ToArray()):n.DeleteUgpConfirmation(t.UGP_FormsConfirmation.NidFormsConfirmation,t)};n.SaveOwnerComment=function(){if(n.Prop.ErrorMessageComment="",n.GamInputData.ReasonComment==undefined||n.GamInputData.ReasonComment==""){n.Prop.ErrorMessageComment="توضیحات را وارد نمایید";n.$apply();return}var t={pDistrict:n.GamInputData.District,pNidProc:n.GamInputData.NidProc,pUGP_FormsConfirmationlist:[{CitizenComments:n.GamInputData.ReasonComment}]},i=JSON.stringify(t);StartBusy("divSendData","در حال دریافت اطلاعات");$.ajax({type:"POST",url:ServiceAddress+"SaveUGP_FormsConfirmation",data:i,contentType:"application/json; charset=utf-8",dataType:"json",success:function(t){if(StopBusy("divSendData"),t.ErrorResult.BizErrors.length>0){var i="";$.each(t.ErrorResult.BizErrors,function(n,t){i+=t.ErrorTitel+"\r\n"});n.Prop.ErrorMessageComment=i}else n.Prop.ErrorMessageComment="اطلاعات با موفقیت ذخیره شد",n.GetOwnerZabetehComment(),n.GamInputData.ReasonComment="",n.GamInputData.EumRequestStatus==5&&$("#btnSendToKartable").show(),GamPlugin.SavelocalStorage(n.Config.ScopeName,n.GamInputData);n.$apply()},failure:function(){StopBusy("divSendData")},error:function(){StopBusy("divSendData")}})};n.GetOwnerZabetehComment=function(){var t={pDistrict:n.GamInputData.District,pNidProc:n.GamInputData.NidProc},i=JSON.stringify(t);StartBusy("divSendData","در حال دریافت اطلاعات");$.ajax({type:"POST",url:ServiceAddress+"GetUGP_FormsConfirmationList",data:i,contentType:"application/json; charset=utf-8",dataType:"json",success:function(t){StopBusy("divSendData");t.ErrorResult.BizErrors.length>0?n.Prop.ErrorMessage="خطا در دریافت اطلاعات":(n.GamInputData.rw==0&&t.UGP_FormsConfirmationList.length==0?(n.UGP_FormsConfirmationListZabete=[],n.Base_UsingList!=null&&n.Base_UsingList.forEach(t=>n.UGP_FormsConfirmationListZabete.push({UGP_FormsConfirmation:{BuildingNo:t.OutBase_Using!=null?t.OutBase_Using.BuildingNo:t.BuildingNo,FloorNoForZabeteh:t.OutBase_Using!=null?t.OutBase_Using.FloorNo:t.FloorNo,CI_UsingGroup:t.OutBase_Using!=null?t.OutBase_Using.CI_UsingGroup:t.CI_UsingGroup,CI_UsingType:t.OutBase_Using!=null?t.OutBase_Using.CI_UsingType:t.CI_UsingType,InfrastructureArea:t.OutBase_Using!=null?t.OutBase_Using.UsingArea:t.UsingArea,UnitCount:t.OutBase_Using!=null?t.OutBase_Using.UnitCount:t.UnitCount,InfrastructureArea:t.OutBase_Using!=null?t.OutBase_Using.UsingArea:t.UsingArea,EumFormsConfirmationType:1,CI_RequirmentForZabeteh:0}}))):(n.UGP_FormsConfirmationList=Enumerable.From(t.UGP_FormsConfirmationList).Where(function(n){return n.UGP_FormsConfirmation.EumFormsConfirmationType==0}).Select(function(n){return n.UGP_FormsConfirmation}).OrderBy("$.CreateDate").ThenBy("$.CreateTime").ToArray(),n.UGP_FormsConfirmationListZabete=Enumerable.From(t.UGP_FormsConfirmationList).Where(function(n){return n.UGP_FormsConfirmation.EumFormsConfirmationType==1}).OrderByDescending("$.UGP_FormsConfirmation.FloorNoForZabeteh").OrderByDescending("$.CI_RequirmentForZabeteh").ToArray(),({UGP_FormsConfirmation:{EumFormsConfirmationType:1,IsNew:!0}}),n.UGP_FormsConfirmationListZabete.length==0&&(n.UGP_FormsConfirmationListZabete=[{UGP_FormsConfirmation:{EumFormsConfirmationType:1,IsNew:!0}},],$("#btnZabeteComment").prop("disabled",!1))),n.$apply(),ReEvent())},failure:function(){StopBusy("divSendData")},error:function(){StopBusy("divSendData")}})};n.SaveZabeteComment=function(){var t,i,r,u;if(n.Prop.ErrorMessageComment="",n.UGP_FormsConfirmationListZabeteNew=n.UGP_FormsConfirmationListZabete,n.UGP_FormsConfirmationListZabeteNew.length==0){n.Prop.ErrorMessageComment="نوع درخواست را مشخص نمایید ";return}if(t=n.UGP_FormsConfirmationListZabeteNew.length-1,n.GamInputData.rw>0&&n.UGP_FormsConfirmationListZabeteNew.length>0&&(n.UGP_FormsConfirmationListZabeteNew[t].UGP_FormsConfirmation==null||n.UGP_FormsConfirmationListZabeteNew[t].UGP_FormsConfirmation.CI_RequirmentForZabeteh==null||n.UGP_FormsConfirmationListZabeteNew[t].UGP_FormsConfirmation.CI_RequirmentForZabeteh==undefined)){n.Prop.ErrorMessageComment="نوع درخواست را مشخص نمایید ";return}n.UGP_FormsConfirmationListZabeteNew=Enumerable.From(n.UGP_FormsConfirmationListZabeteNew).Select(function(n){return n.UGP_FormsConfirmation}).ToArray();n.GamInputData.rw==0&&n.UGP_FormsConfirmationListZabeteNew.forEach(n=>n.CI_RequirmentForZabeteh=0);i=JSON.parse(angular.toJson(n.UGP_FormsConfirmationListZabeteNew));n.UGP_FormsConfirmationListZabeteNew=i;r={pDistrict:n.GamInputData.District,pNidProc:n.GamInputData.NidProc,pUGP_FormsConfirmationlist:n.UGP_FormsConfirmationListZabeteNew,pZabetehChideman:n.ZabetehChideman};u=JSON.stringify(r);StartBusy("divSendDatap","در حال ذخیره اطلاعات");$.ajax({type:"POST",url:ServiceAddress+"SaveUGP_FormsConfirmation",data:u,contentType:"application/json; charset=utf-8",dataType:"json",success:function(t){if(StopBusy("divSendDatap"),t.ErrorResult.BizErrors.length>0){var i="";$.each(t.ErrorResult.BizErrors,function(n,t){i+=t.ErrorTitel+"\r\n"});n.Prop.ErrorMessageComment=i}else n.Prop.ErrorMessageComment="اطلاعات با موفقیت ذخیره شد",n.GetOwnerZabetehComment(),n.GamInputData.FormConfirmationOK=!0,n.ErrorColor="green";n.$apply()},failure:function(){StopBusy("divSendDatap");n.Prop.ErrorMessageComment="خطا در ذخیره اطلاعات";n.ErrorColor="red";n.$apply()},error:function(){StopBusy("divSendDatap");n.Prop.ErrorMessageComment="اطلاعات را صحیح وارد نمایید";n.ErrorColor="red";n.$apply()}})};n.ZabeteCommit=function(){StartBusyTimer("divSelect");n.GamInputData.ZabeteCommit=!0;n.ErrorMessageCommit="پرونده تایید شد . میتوانید به گام بعدی بروید"};n.Quize={FullLable:"",GetQuestionnaire:function(t){var i=n.GamInputData.NidWorkflowDeff;i==undefined&&(i=ClsMenu.ID);StartBusy1("در حال دریافت اطلاعات");var r={pCode:n.GamInputData.CurrentNosaziCode,pNidNosaziCode:n.GamInputData.NidNosaziCode,pSelectedOptions:t,pNidWorkFlowDeff:i},u=JSON.stringify(r),f=ErrorMessageGam;$request=$.ajax({type:"POST",url:ServiceAddress+"GetQuestionnaire",data:u,crossDomin:!0,contentType:"application/json; charset=utf-8",dataType:"json",processdata:!0,success:function(t){StopBusy1();n.Functions.CheckError(t)&&(n.$apply(),n.Questionnaire=t.Questionnaire);n.$apply()},error:function(){n.Prop.ErrorMessage=f;StopBusy1();GetScope().$apply()}})},NextQuiz:function(t){var i,f,u,r;if(t==undefined)if(i=$("input[name=rdbQ]:checked").val(),i!=undefined)$("#LMessageQ").text(""),r=i.split("-")[1],n.QuestionnaireHierarchy[r].HasNextLevel==!0?(n.QuestionnaireHierarchy=n.QuestionnaireHierarchy[r].NextLevel,n.$apply(),$("#DivFinal").hide()):(n.GamInputData.QuestionnaireDetailFinal=n.QuestionnaireHierarchy[r],$("#DivFinal").show(),$("#btnSelectWorkFlowOk").show(),$("#btnNext1").hide());else{$("#LMessageQ").text("لطفا یک مورد را انتخاب نمایید");return}else{if(t==1)if(i=$("input[name=s1]:checked").val(),u=$("input[value="+i+"]").next()[0].innerText,this.FullLable+=u+"   |    ",i=="s1-0")n.Quize.GetQuestionnaire(0);else if(i=="s1-1")n.Quize.GetQuestionnaire(1);else if(i=="s1-2")n.Quize.GetQuestionnaire(2);else{$("#LMessageQ").text("لطفا یک مورد را انتخاب نمایید");return}if(t==2)if(i=$("input[name=s2]:checked").val(),u=$("input[value="+i+"]").next()[0].innerText,this.FullLable+=u+"   |    ",i!=undefined)r=i.split("-")[1],n.QuestionnaireDetail=n.Questionnaire[r].AnswerQuestionMessageContractlist;else{$("#LMessageQ").text("لطفا یک مورد را انتخاب نمایید");return}if(t==3)if(f=$("input[name=s3]:checked").val(),u=$("input[value="+f+"]").next()[0].innerText,this.FullLable+=u+"   |    ",f!=undefined)r=f.split("-")[1],n.GamInputData.QuestionnaireDetailFinal=n.QuestionnaireDetail[r],$("#btnSelectWorkFlowOk").show();else{$("#LMessageQ").text("لطفا یک مورد را انتخاب نمایید");return}$("#DivQ"+t).slideToggle();$("#DivQ"+(t+1)).slideToggle();$("#LMessageQ").text("");n.$apply()}},PreQuiz:function(n){$("#DivQ"+n).slideToggle();$("#DivQ"+(n-1)).slideToggle()},Cancel:function(){n.QuestionnaireHierarchy=n.QuestionnaireHierarchyOrg;$("#DivFinal").hide();$("#btnNext1").show()},SelectWorkFlow:function(){n.GamInputData.SelectedWorkFlow.NidWorkflowDeff=GetScope().GamInputData.QuestionnaireDetailFinal.NidWorkFlowDeff;n.GamInputData.SelectedWorkFlow.WorkflowTitel=GetScope().GamInputData.QuestionnaireDetailFinal.Answer;n.QuestionnaireHierarchy=n.QuestionnaireHierarchyOrg;$("#DivFinal").hide();$("#btnNext1").show();$("#exampleModal").modal("toggle");n.GamInputData.FullLable=this.FullLable},GetWorkFlowQuestion:function(){StartBusy("SelectWorkFlow");var t={pCode:n.GamInputData.CurrentNosaziCode,pNidNosaziCode:n.GamInputData.NidNosaziCode,pSelectedOptions:0},i=JSON.stringify(t);$request=$.ajax({type:"POST",url:ServiceAddress+"GetQuestionnaire",data:i,crossDomin:!0,contentType:"application/json; charset=utf-8",dataType:"json",processdata:!0,success:function(t){StopBusy("SelectWorkFlow");n.Functions.CheckError(t)?(t.Questionnaire.length>0&&(n.WorkFlowSelect=t.Questionnaire),n.$apply()):t.ErrorResult.BizErrors.length>0&&t.ErrorResult.BizErrors[0].ErrorKey=="Stop"&&(n.WorkFlowSelect=null);n.Functions.CheckError(t)&&t.QuestionnaireHierarchy.length>0&&(n.QuestionnaireHierarchyOrg=t.QuestionnaireHierarchy,n.QuestionnaireHierarchy=n.QuestionnaireHierarchyOrg,n.$apply())},error:function(){}})}};var t={};n.QuestionnaireHierarchyList=[];n.FillArray=function(t,i,r=0){angular.forEach(t,function(t,u){n.QuestionnaireHierarchyList.push({index:i+"-"+r+"-"+u,Class:t});t.HasNextLevel==!0&&(r=i+1,n.FillArray(t.NextLevel,i,r))})};n.EngFunc={GetEnginner:function(){$("#DivMohandes").removeClass("disabled");StartBusy1("در حال دریافت لیست مهندسین ناظر");n.$apply();var t={pNidProc:n.GamInputData.NidProc},i=JSON.stringify(t);$.ajax({type:"POST",url:ServiceAddress+"GetBase_ControllerInfo_EngineerSubSys",data:i,contentType:"application/json; charset=utf-8",dataType:"json",success:function(t){if(StopBusy1(),t.ErrorResult.BizErrors.length>0)n.Prop.ErrorMessage="خطا در دریافت لیست مهندسین ناظر",n.GreenColor=!1;else{n.EngList=t.Base_ControllerInfo_EngineerSubSys;var i=Enumerable.From(n.EngList).Select("employee => { Name: employee.EngName + ' ' + employee.EngFamily ,Tell:employee.MobileNo,CI_Ability:employee.CI_Ability}").ToArray();n.EngList.length>0?($("btnOkEnginner").show(),n.GamInputData.ProcInitiator=n.EngList[0].ReferNidUser,n.GamInputData.ProcInitiatorUserName=n.EngList[0].EngName+" "+n.EngList[0].EngFamily,n.GamInputData.EngInfoList=i,n.GreenColor=!0,$("#DivMohandes").removeClass("disabled")):(n.GreenColor=!1,n.Prop.ErrorMessage="مالک محترم ، جهت  اصلاح  ناظرین ساختمانی،  به شهرداری منطقه، اداره شهرسازی ، مراجعه نمایید")}n.$apply()},failure:function(){StopBusy1()},error:function(){StopBusy1();n.Prop.ErrorMessage="اطلاعات مهندس یافت نشد";n.GreenColor=!1;n.$apply()}});n.$apply()},GetEnginnerQuata:function(){$("#DivMohandes").removeClass("disabled");StartBusy1("در حال دریافت لیست مهندسین ناظر");n.$apply();var t={pNidProc:n.GamInputData.NidProc},i=JSON.stringify(t);$.ajax({type:"POST",url:ServiceAddress+"GetBase_ControllerInfo_EngineerSubSys",data:i,contentType:"application/json; charset=utf-8",dataType:"json",success:function(t){if(StopBusy1(),t.ErrorResult.BizErrors.length>0)n.Prop.ErrorMessage="خطا در دریافت لیست مهندسین ناظر",n.GreenColor=!1;else{n.EngList=t.Base_ControllerInfo_EngineerSubSys;var i=Enumerable.From(n.EngList).Select("employee => { Name: employee.EngName + ' ' + employee.EngFamily ,Tell:employee.MobileNo,CI_Ability:employee.CI_Ability}").ToArray();n.GamInputData.EngInfoList=i;n.EngList.length>0?(n.GreenColor=!0,n.SendToShahrsaz()):(n.GreenColor=!1,n.Prop.ErrorMessage="مالک محترم ، جهت  اصلاح  ناظرین ساختمانی،  به شهرداری منطقه، اداره شهرسازی ، مراجعه نمایید")}n.$apply()},failure:function(){StopBusy1()},error:function(){StopBusy1();n.Prop.ErrorMessage="خطا در ارسال اطلاعات";n.GreenColor=!1;n.$apply()}});n.$apply()},GetEngInfo:function(){var t={NidWorkItem:n.GamInputData.NidWorkItem},i=JSON.stringify(t);StartBusy("divSendData","در حال دریافت اطلاعات");$.ajax({type:"POST",url:"Frmparvaneh.aspx/GetEngInfo",data:i,contentType:"application/json; charset=utf-8",dataType:"json",success:function(t){StopBusy("divSendData");t.d==null?n.Prop.ErrorMessage="خطا در دریافت اطلاعات":(n.EngInfoList=t.d,n.$apply(),$("#btnPre").hide())},failure:function(){StopBusy("divSendData")},error:function(){StopBusy("divSendData")}})},GetEngineerYazdDafater:function(){$("#DivMohandes").removeClass("disabled");StartBusy1("در حال دریافت لیست مهندسین ناظر");n.$apply();(n.GamInputData.FloorDone==undefined||n.GamInputData.FloorDone==""||n.GamInputData.FloorDone==null)&&(n.GamInputData.FloorDone="0");(n.GamInputData.BuildingType==undefined||n.GamInputData.BuildingType==""||n.GamInputData.BuildingType==null)&&(n.GamInputData.BuildingType="0");(n.GamInputData.foundation==undefined||n.GamInputData.foundation==""||n.GamInputData.foundation==null)&&(n.GamInputData.foundation="0");var t={url:"https://46.100.249.195:7000/shahrvand_separi/",method:"POST",timeout:0,headers:{"Content-Type":"application/json"},data:JSON.stringify({renovation_code:n.GamInputData.CurrentNosaziCode,secretariat_number:n.GamInputData.NidWorkItem,foundation:n.GamInputData.foundation,number_of_floors:n.GamInputData.FloorDone,building_type:n.GamInputData.BuildingType,owner_contact_number:n.ClsAccount.AccountInfo.OwnerTell,owner_national_code:n.ClsAccount.AccountInfo.OwnerNationalCode,is_urban_planning_license_active:n.GamInputData.EumRequestStatus,urban_planning_license_type:n.GamInputData.SelectedWorkFlow.NidWorkflowDeff+" | "+n.GamInputData.SelectedWorkFlow.WorkflowTitel,owner_national_code:ClsAccount.AccountInfo.OwnerNationalCode,owner_firstname_and_lastname:ClsAccount.AccountInfo.OwnerFirstName+" "+ClsAccount.AccountInfo.OwnerLastName,license_issuer_reference:"شهرداری منطقه "+n.GamInputData.District,area:n.GamInputData.District})};$.ajax(t).done(function(t){StopBusy1();n.EngDafaterList=shuffleArray(t);n.EngDafaterListAll=n.EngDafaterList;n.$apply()});$.ajax(t).fail(function(){StopBusy1()});n.$apply()},SelectDaftar:function(t){n.GamInputData.SelectDaftar=t;t.IsSelect=!0},OfficeSelection:function(){$("#DivMohandes").removeClass("disabled");StartBusy1("در حال ارسال دفاتر به سرویس مهندس ناظر");n.$apply();var t={url:"https://46.100.249.195:7000/office_celection/",method:"POST",timeout:0,headers:{"Content-Type":"application/json"},data:JSON.stringify({secretariat_number:n.GamInputData.NidWorkItem,owner_national_code:n.ClsAccount.AccountInfo.OwnerNationalCode,office_id:n.GamInputData.SelectDaftar.daf_id})};$.ajax(t).done(function(){StopBusy1();n.Prop.ErrorMessage="دفتر مورد نظر انتخاب شد . تا 48 ساعت دیگر نتیجه آن اعلام میگردد";n.EngFunc.SaveOffice(n.GamInputData.SelectDaftar);n.$apply()});$.ajax(t).fail(function(){StopBusy1()})},GetOffice:function(){var t={pNidWorkItem:n.GamInputData.NidWorkItem},i=JSON.stringify(t);$.ajax({type:"POST",url:"UTransferGam.aspx/GetOffice",data:i,contentType:"application/json; charset=utf-8",dataType:"json",success:function(t){n.GamInputData.SelectDaftar=t.d;n.$apply()}})},SaveOffice:function(t){t.NidWorkItem=n.GamInputData.NidWorkItem;var i={pEngOffice:t},r=JSON.stringify(i);$.ajax({type:"POST",url:"UTransferGam.aspx/SaveOffice",data:r,contentType:"application/json; charset=utf-8",dataType:"json",success:function(){}})}};n.GetCI_List=function(i,r){var u=t[i],f,e;if(u==undefined)f={PCiName:i},e=JSON.stringify(f),$.ajax({type:"POST",url:CI_Service+"GetCI",data:e,crossDomin:!0,contentType:"application/json; charset=utf-8",dataType:"json",processdata:!0,success:function(r){t[i]=r;n.$apply()},error:function(){}});else return u=t[i],n.CI_list=u,Enumerable.From(n.CI_list).Where(function(n){return n.Id==r}).Select(function(n){return n.Title}).FirstOrDefault()};n.GetCI=function(i,r){var u=t[i],f,e;if(u==undefined)f={PCiName:i},e=JSON.stringify(f),$.ajax({type:"POST",url:CI_Service+"GetCI",data:e,crossDomin:!0,contentType:"application/json; charset=utf-8",dataType:"json",processdata:!0,success:function(r){t[i]=r;n.$apply()},error:function(){}});else return u=t[i],n.CI_list=u,Enumerable.From(n.CI_list).Where(function(n){return n.Id==r}).Select(function(n){return n.Title}).FirstOrDefault()};n.GetCI_ListCombo=function(n){return t[n]};n.GetCI_ListCombo2=function(n){var i=t[n];return i!=undefined?i.GetCIResult!=undefined?i.GetCIResult:i:null};n.GetCI_List2=function(i,r){var u=t[i],f,e;u==undefined?(f={PCiName:i},e=JSON.stringify(f),$.ajax({type:"POST",url:CI_Service+"GetCI",data:e,crossDomin:!0,contentType:"application/json; charset=utf-8",dataType:"json",processdata:!0,success:function(u){t[i]=u;n.$apply();r(t[i])},error:function(){}})):(u=t[i],r(u))};n.GetADP_List=function(){var t=GetUrlByDomain(SrvSC,1);$.ajax({type:"POST",url:t+"GetADP_UsingTypeList",crossDomin:!0,contentType:"application/json; charset=utf-8",dataType:"json",processdata:!0,success:function(t){n.ADP=t.ADP_UsingTypeList;n.$apply()},error:function(){}})};LoadOutSideFunction();n.ShowPishFactor=function(){var n="RptInvoice&ReportParameter=NidProc;"+GetScope().GamInputData.NidProc+",District;"+GetScope().GamInputData.District+",TokenKey;";window.open(FactorUrl+n,"_blank")};n.SendToShahrsaz=function(t,i=true){var f=GamsArray[GamPlugin.CurrentStep],r,u;if(t==3&&f.Name!="MokatebatDastoor"){if(n.GamInputData.MustUploadLetterCount!=undefined&&n.GamInputData.MustUploadLetterCount<n.LetterList_OUT.length||(n.GamInputData.MustUploadLetterCount==undefined||n.GamInputData.MustUploadLetterCount==null)&&n.LetterList_OUT.length>0){n.Prop.ErrorMessage="لطفا نامه های برون سازمانی را بارگذاری نمایید";return}n.GamInputData.UploadDwg!=!0&&(n.Prop.ErrorMessage+="\r\nفایل پیش نقشه باید بارگذاری شود",LetterRes=!1)}if(t==1&&i==!1&&n.GamInputData.UploadShFaniOk!=!0){n.Prop.ErrorMessageComment="مدارک لازم برای دلیل عدم تایید را ارسال نمایید";n.ErrorColor="red";return}if(t==5&&(n.GamInputData.MustUploadLetterCountNew==undefined||n.GamInputData.MustUploadLetterCountNew<n.LetterList_New.length)){n.Prop.ErrorMessage="لطفا نقصی مدارک را کامل نمایید";return}n.Prop.ErrorMessage=null;r={pDomain:n.GamInputData.District,pNidProc:n.GamInputData.NidProc};u=JSON.stringify(r);StartBusy("MainGam","در حال ارسال پرونده");$.ajax({data:u,type:"POST",url:ServiceAddress+"ExitFromTemporaryKartabl",crossDomin:!0,contentType:"application/json; charset=utf-8",dataType:"json",processdata:!0,success:function(r){StopBusy("MainGam");r.ErrorResult.BizErrors.length>0?(n.Prop.ErrorMessageComment="خطا در ارسال پرونده",n.ErrorColor="red"):(n.ErrorColor="green",n.Prop.ErrorMessageComment="پرونده با موفقیت ارسال شد",$("#btnSendToKartable").prop("disabled",!0),$("#btnSendToKartable2").prop("disabled",!0),$("#DivExport").addClass("disabled"),$("#divLetters").addClass("disabled",!0),$("#divShZabete").addClass("disabled"),$("#DivComm").addClass("disabled"),i&&(n.GamInputData.ShFaniOk=="true"&&n.GamInputData.SendToShahrsazOk!=!0?(n.GamInputData.SendToShahrsazOk=!0,n.Functions.ConfirmOnFormsConfirmation(0)):t==2&&(n.GamInputData.SendToShahrsazOk2=!0,n.Functions.ConfirmOnFormsConfirmation(1),n.Prop.ErrorMessageComment="تغییرات مورد نظر شما توسط کارشناس شهرداری بررسی و نتیجه پیامک می شود"),t==3&&(n.GamInputData.SendToShahrsazOk3=!0),t==4&&(n.GamInputData.SendToShahrsazOk4=!0),t==5&&(n.GamInputData.SendToShahrsazOk5=!0)),GamPlugin.SavelocalStorage(n.Config.ScopeName,n.GamInputData));n.$apply()},error:function(){StopBusy("MainGam");n.Prop.ErrorMessageComment="خطا در اجرای عملیات";n.$apply()}})};n.SearchDaftar=function(){var t=$("#txtSearchDaftar").val();n.EngDafaterList=t==""?n.EngDafaterListAll:Enumerable.From(n.EngDafaterListAll).Where(function(n){return n.ozv_name.indexOf(t)>-1||n.daf_name.indexOf(t)>-1}).ToArray();n.$apply()};n.DeleteUgpConfirmation=function(t,i){var f=confirm("آیا مطمئن هستید؟"),r,u;f==!0&&(r={pNidFormsConfirmation:t,pDistrict:n.GamInputData.District},u=JSON.stringify(r),$.ajax({type:"POST",url:ServiceAddress+"DeleteUGP_FormsConfirmation ",data:u,contentType:"application/json; charset=utf-8",dataType:"json",success:function(){dictionary=Enumerable.From(n.UGP_FormsConfirmationListZabete).ToDictionary();dictionary.Remove(i);n.UGP_FormsConfirmationListZabete=dictionary.ToEnumerable().Select(n=>n.Key).ToArray();n.$apply()}}))};n.myFunction=function(n,t){var i=Enumerable.From(GetScope().ADP).Where(function(t){return t.CI_UsingGroup==n}).Select(function(n){return n.CI_UsingType}).ToArray(),r=Enumerable.From(GetScope().CI_UsingType).Where(function(n){return Enumerable.From(i).Contains(n.Id)}).ToArray();$("#cmbCI_UsingType"+t).empty();$.each(r,function(n,i){$("#cmbCI_UsingType"+t).append(new Option(i.Title,i.Id))});GetScope().$apply()}}],shuffleArray=function(n){for(var t=n.length,r,i;t;)i=Math.floor(Math.random()*t--),r=n[t],n[t]=n[i],n[i]=r;return n},s1="asc",s2="asc";