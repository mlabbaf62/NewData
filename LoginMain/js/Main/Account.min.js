function fncsave(){var n=$("#txtUserName").val(),t=$("#txtPassword").val();n.length==0?$("#LMessage").text("نام کاربری را وارد نمایید"):t.length==0?$("#LMessage").text("کلمه عبور را وارد نمایید"):$("#MainCaptcha").length>0?okCaptcha?DoLogin(n,t):$("#LMessage").text("کد امنیتی را وارد نمایید"):DoLogin(n,t)}function fncChangePassword(){var t=window.btoa($("#txtPassword").val()),i=window.btoa($("#txtPasswordNew").val()),r=window.btoa($("#txtConfirmPassword").val()),n;if($("#txtOldPasswordEnc").val(t),$("#PEnc").val(i),$("#txtReNewPasswordEnc").val(r),n=!0,$("#txtConfirmPassword").val()!=$("#txtPasswordNew").val()){$("#LMessage").css("color","red");$("#LMessage").text("رمز عبور و تکرار آن باید شبیه هم باشند");n=!1;return}if(Config.PassWordComplex==!0&&(checkStrength($("#txtPasswordNew").val()),PasswordComplexValid==!1)){$("#LMessage").css("color","red");$("#LMessage").text("رمز عبور باید شامل حروف و اعداد و کلمات پیچیده باشد");n=!1;return}if($("#MainCaptcha").length>0&&!okCaptcha){$("#LMessage").text("کد امنیتی را وارد نمایید");n=!1;return}n&&document.getElementById("btnSave").click()}function DoLogin(n,t){try{StartBusy("loginBox","در حال احراز هویت کاربر");var i=window.btoa(n),r=window.btoa(t);i=i+SessionId;r=r+SessionId;i=window.btoa(i);r=window.btoa(r);$("#UNEnc").val(i);$("#PEnc").val(r);document.getElementById("btnLogin").click()}catch(u){StopBusy("loginBox");alert("صفحه کلید را در حالت انگلیسی قرار دهید")}}function DetectToken(){StartBusyTimer("form1","در حال شناسایی شناسه");CheckToken("1234")}function TokenComplete(n){$("#txtToken").val(n)}function ShowRecoveryPassDiv(){$(".RecveryPassBox").show();$("#DivRecovery").show();$("html, body").animate({scrollTop:$(".RecveryPassBox").offset().top},1e3)}function SendSMS0(){StartBusy("DivRecovery","در حال پردازش اطلاعات");CallRequestToken(function(n){if($("#LRecoveryError").text(""),$("#txtRecoveryMobile").val()==""){$("#LRecoveryError").text("شماره همراه را وارد نمایید");$("#LRecoveryError").css("Color","red");return}var t={pMobileNo:$("#txtRecoveryMobile").val()},i=JSON.stringify(t);$.ajax({type:"POST",url:AppConfig.Params.SecurityUrl+"RecoveryAccountPassword",data:i,beforeSend:function(t){t.setRequestHeader("TrustToken",n)},contentType:"application/json; charset=utf-8",dataType:"json",success:function(n){StopBusy("DivRecovery");n.BizErrors.length>0?ShowError(n):($("#LRecoveryError").text("رمز عبور با موفقیت ارسال شد"),$("#LRecoveryError").css("color","green"),StartTimer())},failure:function(n){alert(n.d);StopBusy("DivRecovery")},error:function(){alert("درخواست نامعتبر است ، لطفا صفحه را بازآوری کنید");StopBusy("DivRecovery")}})})}function SendSMS(){if(StartBusy("DivRecovery","در حال پردازش اطلاعات"),$("#LRecoveryError").text(""),$("#txtRecoveryMobile").val()==""){$("#LRecoveryError").text("شماره همراه را وارد نمایید");$("#LRecoveryError").css("Color","red");return}var n={pMobileNo:$("#txtRecoveryMobile").val()},t=JSON.stringify(n);$.ajax({type:"POST",url:"SafaLogin.aspx/RecoveryAccountPassword",data:t,contentType:"application/json; charset=utf-8",dataType:"json",success:function(n){StopBusy("DivRecovery");n.d.BizErrors.length>0?ShowError(n.d):($("#LRecoveryError").text("رمز عبور با موفقیت ارسال شد"),$("#LRecoveryError").css("color","green"),StartTimer())},failure:function(n){alert(n.d);StopBusy("DivRecovery")},error:function(){alert("درخواست نامعتبر است ، لطفا صفحه را بازآوری کنید");StopBusy("DivRecovery")}})}function CallRequestToken(n){$request=$.ajax({type:"POST",url:AppConfig.Params.SecurityUrl+"RequestToken",crossDomin:!0,contentType:"application/json; charset=utf-8",dataType:"json",processdata:!0,success:function(t){n(t)},error:function(){alert("لطفا بعد از 1 دقیقه امتحان نمایید")}})}function StartTimer(){$("#btnSend").attr("disabled",!0);$("#btnSend").css("opacity",.5);$("#lblComment").remove();$("#LRecoveryError").after("<p id='lblComment' style=\"font-size:small\">در صورت ارسال نشدن پیامک ، بعد از ۶۰ ثانیه میتوانید دوباره دکمه ارسال رمز را بزنید<\/p>");indexTime=60;Counter=setInterval(myFunction,1e3)}function myFunction(){indexTime--;$("#LRecoveryError").text(indexTime);indexTime==0&&($("#btnSend").attr("disabled",!1),$("#btnSend").css("opacity",1),clearInterval(Counter))}function ToggleShowPass(){var i=document.getElementById("txtPassword"),n=document.getElementById("txtPasswordNew"),t=document.getElementById("txtConfirmPassword");i.type==="password"?(i.type="text",n!=null&&(n.type="text"),t!=null&&(t.type="text"),$("#imgShowPass").prop("src","../images/showpass.png"),$("#imgShowPass").prop("title","پنهان کردن رمز عبور")):(i.type="password",n!=null&&(n.type="password"),t!=null&&(t.type="password"),$("#imgShowPass").prop("src","../images/showpassOff.png"),$("#imgShowPass").prop("title","نمایش رمز عبور"))}function ShowError(n){try{$("#LRecoveryError").css("color","red");n!=null?$("#LRecoveryError").text(n.BizErrors[0].ErrorTitel):$("#LRecoveryError").text("خطا در اجرای سرویس")}catch(t){}}function checkStrength(n){PasswordComplexValid=!1;var t=0;return n.length<5?($("#result").removeClass(),$("#result").addClass("short"),$("#progressBar").removeClass(),$("#progressBar").width("30%"),$("#progressBar").addClass("progress-bar progress-bar-danger"),"رمز عبور باید حداقل 5 کاراکتر باشد"):(n.length>7&&(t+=1),n.match(/([a-z].*[A-Z])|([A-Z].*[a-z])/)&&(t+=1),n.match(/([a-zA-Z])/)&&n.match(/([0-9])/)&&(t+=1),n.match(/([!,%,&,@,#,$,^,*,?,_,~])/)&&(t+=1),n.match(/(.*[!,%,&,@,#,$,^,*,?,_,~].*[!,%,&,@,#,$,^,*,?,_,~])/)&&(t+=1),t<2?($("#result").removeClass(),$("#result").addClass("weak"),$("#progressBar").removeClass(),$("#progressBar").width("30%"),$("#progressBar").addClass("progress-bar progress-bar-danger"),"ضعیف"):t==2?($("#result").removeClass(),$("#result").addClass("good"),$("#progressBar").removeClass(),$("#progressBar").width("70%"),$("#progressBar").addClass("progress-bar progress-bar-blue"),"خوب"):(PasswordComplexValid=!0,$("#result").removeClass(),$("#result").addClass("strong"),$("#progressBar").removeClass(),$("#progressBar").width("100%"),$("#progressBar").addClass("progress-bar progress-bar-success"),"پیچیده"))}var SessionId="",Counter=null,indexTime=60;